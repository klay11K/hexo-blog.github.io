<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Redis 基础 | klay的知识星球</title>
  <meta name="description" content="Redis基础Redis 入门概述Redis 是什么？Redis 是一种基于内存的 K-V 键值对缓存数据库。 Redis 能做什么？ 分布式缓存，减轻 MySQL 的压力 内存存储和持久化（ROD + AOF） 分布式锁 队列  Redis 安装安装步骤1234567891011121314151617# 进入 &#x2F;opt 目录cd &#x2F;opt# 下载获取 redis-7.4.1.tar.gz 包w">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 基础">
<meta property="og:url" content="http://example.com/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="努力沉淀">
<meta property="og:description" content="Redis基础Redis 入门概述Redis 是什么？Redis 是一种基于内存的 K-V 键值对缓存数据库。 Redis 能做什么？ 分布式缓存，减轻 MySQL 的压力 内存存储和持久化（ROD + AOF） 分布式锁 队列  Redis 安装安装步骤1234567891011121314151617# 进入 &#x2F;opt 目录cd &#x2F;opt# 下载获取 redis-7.4.1.tar.gz 包w">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241205162624301.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206160055624.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206152122784.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206153110134.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216232223472.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234631630.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234800372.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234831601.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234910211.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234958862.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235038722.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235209600.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235314898.png">
<meta property="og:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241220093104263.png">
<meta property="article:published_time" content="2024-12-22T01:57:06.121Z">
<meta property="article:modified_time" content="2024-12-22T02:11:09.962Z">
<meta property="article:author" content="klay">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241205162624301.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://example.com/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/index.html">
  
    <link rel="alternate" href="/atom.xml" title="努力沉淀" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.2"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/klay11K/klay11K.github.io" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">函数式编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PDF/">PDF</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/openGauss/">openGauss</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E9%9B%86%E5%90%88/" rel="tag">Java集合</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Junit/" rel="tag">Junit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PDF/" rel="tag">PDF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openGauss/" rel="tag">openGauss</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/HTML/" style="font-size: 13px;">HTML</a> <a href="/tags/Hexo/" style="font-size: 14px;">Hexo</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 13.67px;">Java基础</a> <a href="/tags/Java%E9%9B%86%E5%90%88/" style="font-size: 13px;">Java集合</a> <a href="/tags/Junit/" style="font-size: 13px;">Junit</a> <a href="/tags/Linux/" style="font-size: 13px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.67px;">MySQL</a> <a href="/tags/PDF/" style="font-size: 13px;">PDF</a> <a href="/tags/Redis/" style="font-size: 13.33px;">Redis</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/github/" style="font-size: 13px;">github</a> <a href="/tags/openGauss/" style="font-size: 13.33px;">openGauss</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 13px;">函数式编程</a> <a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 13px;">微信小程序</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 13px;">计算机基础</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 13px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">设计模式</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Redis/">Redis</a>
              </p>
              <p class="item-title">
                <a href="/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/" class="title">Redis 基础</a>
              </p>
              <p class="item-date">
                <time datetime="2024-12-22T01:57:06.121Z" itemprop="datePublished">2024-12-22</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/MySQL/">MySQL</a>
              </p>
              <p class="item-title">
                <a href="/2024/11/12/MySQL/mysql-%E9%9D%A2%E8%AF%95%E9%A2%98/" class="title">MySQL 面试题</a>
              </p>
              <p class="item-date">
                <time datetime="2024-11-12T01:22:52.025Z" itemprop="datePublished">2024-11-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/MySQL/">MySQL</a>
              </p>
              <p class="item-title">
                <a href="/2024/10/24/MySQL/mysql-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" class="title">MySQL 基本语法</a>
              </p>
              <p class="item-date">
                <time datetime="2024-10-24T01:34:06.162Z" itemprop="datePublished">2024-10-24</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/MySQL/">MySQL</a>
              </p>
              <p class="item-title">
                <a href="/2024/10/24/MySQL/mysql-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="title">MySQL 常用命令</a>
              </p>
              <p class="item-date">
                <time datetime="2024-10-24T01:34:03.049Z" itemprop="datePublished">2024-10-24</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Redis/">Redis</a>
              </p>
              <p class="item-title">
                <a href="/2024/10/16/redis/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="title">Redis 学习笔记</a>
              </p>
              <p class="item-date">
                <time datetime="2024-10-16T09:08:29.106Z" itemprop="datePublished">2024-10-16</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Redis基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Redis 入门概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">Redis 是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.1.2.</span> <span class="toc-text">Redis 能做什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.3.</span> <span class="toc-text">Redis 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">安装步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%B8%A9%E5%9D%91"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">安装踩坑</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B8%A9%E5%9D%911-%EF%BC%9A-bin-sh-cc-%E6%9C%AA%E6%89%BE%E5%88%B0%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.3.2.1.</span> <span class="toc-text">踩坑1:：&#x2F;bin&#x2F;sh: cc: 未找到命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B8%A9%E5%9D%912%EF%BC%9Azmalloc-h-29-31-%E8%87%B4%E5%91%BD%E9%94%99%E8%AF%AF%EF%BC%9Ajemalloc-jemalloc-h%EF%BC%9A%E6%B2%A1%E6%9C%89%E9%82%A3%E4%B8%AA%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.3.2.2.</span> <span class="toc-text">踩坑2：zmalloc.h:29:31: 致命错误：jemalloc&#x2F;jemalloc.h：没有那个文件或目录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">配置文件配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%8D%B8%E8%BD%BD"><span class="toc-number">1.1.4.</span> <span class="toc-text">Redis 卸载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Redis 数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">Redis 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#String-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">String 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SET"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">SET</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.2.</span> <span class="toc-text">list 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LPUSH"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">LPUSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RPUSH"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">RPUSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LRANGE"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">LRANGE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LPOP"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">LPOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RPOP"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">RPOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LINDEX"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">LINDEX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LLEN"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">LLEN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LREM"><span class="toc-number">1.3.2.8.</span> <span class="toc-text">LREM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LTRIM"><span class="toc-number">1.3.2.9.</span> <span class="toc-text">LTRIM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LSET"><span class="toc-number">1.3.2.10.</span> <span class="toc-text">LSET</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LINSERT"><span class="toc-number">1.3.2.11.</span> <span class="toc-text">LINSERT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.3.</span> <span class="toc-text">hash 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HSET"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">HSET</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HGET"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">HGET</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HMGET"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">HMGET</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HGETALL"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">HGETALL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDEL"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">HDEL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HLEN"><span class="toc-number">1.3.3.6.</span> <span class="toc-text">HLEN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HEXISTS"><span class="toc-number">1.3.3.7.</span> <span class="toc-text">HEXISTS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HKEYS"><span class="toc-number">1.3.3.8.</span> <span class="toc-text">HKEYS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HVALS"><span class="toc-number">1.3.3.9.</span> <span class="toc-text">HVALS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HINCRBY"><span class="toc-number">1.3.3.10.</span> <span class="toc-text">HINCRBY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HINCRBYFLOAT"><span class="toc-number">1.3.3.11.</span> <span class="toc-text">HINCRBYFLOAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HSETNX"><span class="toc-number">1.3.3.12.</span> <span class="toc-text">HSETNX</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.4.</span> <span class="toc-text">set 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SADD"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">SADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SMEMBERS"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">SMEMBERS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SISMEMBER"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">SISMEMBER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SREM"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">SREM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SCARD"><span class="toc-number">1.3.4.5.</span> <span class="toc-text">SCARD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SRANDMEMBER"><span class="toc-number">1.3.4.6.</span> <span class="toc-text">SRANDMEMBER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SPOP"><span class="toc-number">1.3.4.7.</span> <span class="toc-text">SPOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SMOVE"><span class="toc-number">1.3.4.8.</span> <span class="toc-text">SMOVE</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zset-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.5.</span> <span class="toc-text">zset 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ZADD"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">ZADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZRANGE"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">ZRANGE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZSCORE"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">ZSCORE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZCARD"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">ZCARD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZCOUNT"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">ZCOUNT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZREM"><span class="toc-number">1.3.5.6.</span> <span class="toc-text">ZREM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZINCRBY"><span class="toc-number">1.3.5.7.</span> <span class="toc-text">ZINCRBY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZRANK"><span class="toc-number">1.3.5.8.</span> <span class="toc-text">ZRANK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZREVRANK"><span class="toc-number">1.3.5.9.</span> <span class="toc-text">ZREVRANK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZMPOP"><span class="toc-number">1.3.5.10.</span> <span class="toc-text">ZMPOP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitmap-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.6.</span> <span class="toc-text">bitmap 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SETBIT"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">SETBIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GETBIT"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">GETBIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BITCOUNT"><span class="toc-number">1.3.6.3.</span> <span class="toc-text">BITCOUNT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BITOP"><span class="toc-number">1.3.6.4.</span> <span class="toc-text">BITOP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HyperLogLog-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.7.</span> <span class="toc-text">HyperLogLog 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PFADD"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">PFADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PFCOUNT"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">PFCOUNT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PFMERGE"><span class="toc-number">1.3.7.3.</span> <span class="toc-text">PFMERGE</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GEO-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.8.</span> <span class="toc-text">GEO 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GEOADD"><span class="toc-number">1.3.8.1.</span> <span class="toc-text">GEOADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEOPOS"><span class="toc-number">1.3.8.2.</span> <span class="toc-text">GEOPOS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEOHASH"><span class="toc-number">1.3.8.3.</span> <span class="toc-text">GEOHASH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEODIST"><span class="toc-number">1.3.8.4.</span> <span class="toc-text">GEODIST</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEOSEARCH"><span class="toc-number">1.3.8.5.</span> <span class="toc-text">GEOSEARCH</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stream-%E9%98%9F%E5%88%97%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.9.</span> <span class="toc-text">Stream 队列常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XADD"><span class="toc-number">1.3.9.1.</span> <span class="toc-text">XADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XRANGE"><span class="toc-number">1.3.9.2.</span> <span class="toc-text">XRANGE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XREVRANGE"><span class="toc-number">1.3.9.3.</span> <span class="toc-text">XREVRANGE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XDEL"><span class="toc-number">1.3.9.4.</span> <span class="toc-text">XDEL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XLEN"><span class="toc-number">1.3.9.5.</span> <span class="toc-text">XLEN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XREAD"><span class="toc-number">1.3.9.6.</span> <span class="toc-text">XREAD</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stream-%E6%B6%88%E8%B4%B9%E8%80%85%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.10.</span> <span class="toc-text">Stream 消费者常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XGROUP"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">XGROUP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XREADGROUP"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">XREADGROUP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XPENDING"><span class="toc-number">1.3.10.3.</span> <span class="toc-text">XPENDING</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XACK"><span class="toc-number">1.3.10.4.</span> <span class="toc-text">XACK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XINFO-STREAM"><span class="toc-number">1.3.10.5.</span> <span class="toc-text">XINFO STREAM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XINFO-GROUPS"><span class="toc-number">1.3.10.6.</span> <span class="toc-text">XINFO GROUPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XINFO-CONSUMERS"><span class="toc-number">1.3.10.7.</span> <span class="toc-text">XINFO CONSUMERS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BitField-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.11.</span> <span class="toc-text">BitField 常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">Redis 持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB"><span class="toc-number">1.4.1.</span> <span class="toc-text">RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%EF%BC%88Snapshotting%EF%BC%89%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">快照（Snapshotting）配置和使用说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-dump-rdb-%E8%BF%9B%E8%A1%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">如何使用 dump.rdb 进行恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">RDB 的优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB-%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">RDB 的缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%92%8C%E4%BF%AE%E5%A4%8D-rdb-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">检查和修复 rdb 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%87%BA%E5%8F%91-RDB-%E5%BF%AB%E7%85%A7"><span class="toc-number">1.4.1.7.</span> <span class="toc-text">哪些情况下会出发 RDB 快照</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A6%81%E7%94%A8%E5%BF%AB%E7%85%A7"><span class="toc-number">1.4.1.8.</span> <span class="toc-text">如何禁用快照</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF"><span class="toc-number">1.4.2.</span> <span class="toc-text">AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">AOF 工作流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E5%9B%9E%E7%AD%96%E7%95%A5"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">AOF 缓冲区写回策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">AOF 配置和使用说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">AOF 文件损坏修复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E4%BC%98%E5%8A%BF"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">AOF 优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E5%8A%A3%E5%8A%BF"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">AOF 劣势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">AOF 重写机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AOF-%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.2.7.1.</span> <span class="toc-text">AOF 重写机制配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%87%BA%E5%8F%91-AOF-%E9%87%8D%E5%86%99"><span class="toc-number">1.4.2.7.2.</span> <span class="toc-text">手动出发 AOF 重写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB-AOF-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.4.3.</span> <span class="toc-text">RDB+AOF 混合持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E6%97%B6%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%92%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">数据恢复时的顺序和流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-RDB-AOF-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">开启 RDB+AOF 的配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">纯缓存模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.5.</span> <span class="toc-text">Redis 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">如何使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">1.5.3.</span> <span class="toc-text">事务中的错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9B%91%E6%8E%A7"><span class="toc-number">1.5.4.</span> <span class="toc-text">事务监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E4%BA%8B%E5%8A%A1%E5%92%8C-MySQL-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.5.</span> <span class="toc-text">Redis 事务和 MySQL 事务的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E7%AE%A1%E9%81%93%EF%BC%88pipelining%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">Redis 管道（pipelining）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E5%92%8C%E5%8E%9F%E7%94%9F%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">1.6.1.</span> <span class="toc-text">管道和原生命令的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%EF%BC%88Pub-Sub%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">Redis 发布订阅（Pub&#x2F;Sub）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%EF%BC%88replica%EF%BC%89"><span class="toc-number">1.8.</span> <span class="toc-text">Redis 复制（replica）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.8.1.</span> <span class="toc-text">Redis 复制是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">1.8.2.</span> <span class="toc-text">Redis 复制的工作机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">1.8.3.</span> <span class="toc-text">Redis 复制的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.8.4.</span> <span class="toc-text">Redis 复制的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.5.</span> <span class="toc-text">Redis 复制的常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%92%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.6.</span> <span class="toc-text">Redis 工作流程和原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%A4%8D%E5%88%B6%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.8.7.</span> <span class="toc-text">Redis 复制的缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E5%93%A8%E5%85%B5%EF%BC%88sentinel%EF%BC%89"><span class="toc-number">1.9.</span> <span class="toc-text">Redis 哨兵（sentinel）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%93%A8%E5%85%B5%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.9.1.</span> <span class="toc-text">Redis 哨兵是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%93%A8%E5%85%B5%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.9.2.</span> <span class="toc-text">Redis 哨兵的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.9.3.</span> <span class="toc-text">Redis 哨兵配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%93%A8%E5%85%B5%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.4.</span> <span class="toc-text">Redis 哨兵的运行原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">哨兵运行流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0-master-%E9%80%89%E4%B8%BE%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">新 master 选举流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.9.5.</span> <span class="toc-text">哨兵使用建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%EF%BC%88cluster%EF%BC%89"><span class="toc-number">1.10.</span> <span class="toc-text">Redis 集群（cluster）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E5%88%86%E7%89%87"><span class="toc-number">1.10.1.</span> <span class="toc-text">Redis 集群分片</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%89%87%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">分片是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E7%BB%99%E5%AE%9A-key-%E7%9A%84%E5%88%86%E7%89%87%EF%BC%9F"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">如何找到给定 key 的分片？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%A7%BD%E4%BD%8D-slot"><span class="toc-number">1.10.2.</span> <span class="toc-text">Redis 集群的槽位 slot</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#slot-%E6%A7%BD%E4%BD%8D%E6%98%A0%E5%B0%84%E7%9A%84%E4%B8%89%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">slot 槽位映射的三种解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E5%8F%96%E4%BD%99%E5%88%86%E5%8C%BA"><span class="toc-number">1.10.2.1.1.</span> <span class="toc-text">哈希取余分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%88%86%E5%8C%BA"><span class="toc-number">1.10.2.1.2.</span> <span class="toc-text">一致性哈希算法分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%A7%BD%E5%88%86%E5%8C%BA"><span class="toc-number">1.10.2.1.3.</span> <span class="toc-text">哈希槽分区</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0"><span class="toc-number">1.10.2.1.3.1.</span> <span class="toc-text">为什么会出现</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="toc-number">1.10.2.1.3.2.</span> <span class="toc-text">能干什么</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A4%9A%E5%B0%91%E4%B8%AA-hash-%E6%A7%BD"><span class="toc-number">1.10.2.1.3.3.</span> <span class="toc-text">多少个 hash 槽</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%A7%BD%E8%AE%A1%E7%AE%97"><span class="toc-number">1.10.2.1.3.4.</span> <span class="toc-text">哈希槽计算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-Redis-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9C%80%E5%A4%A7%E6%A7%BD%E6%95%B0%E6%98%AF-16384-%E4%B8%AA%EF%BC%9F"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">为什么 Redis 集群的最大槽数是 16384 个？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E9%9B%86%E7%BE%A4%E4%B8%80%E8%87%B4%E6%80%A7%E4%BF%9D%E8%AF%81"><span class="toc-number">1.10.3.</span> <span class="toc-text">Redis集群一致性保证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.10.4.</span> <span class="toc-text">Redis 集群配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.10.5.</span> <span class="toc-text">Redis 集群常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">1.10.6.</span> <span class="toc-text">Redis 集群搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E5%AE%B9%E9%94%99%E8%BF%81%E7%A7%BB"><span class="toc-number">1.10.7.</span> <span class="toc-text">Redis 容错迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9"><span class="toc-number">1.10.8.</span> <span class="toc-text">Redis 集群扩容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%BC%A9%E5%AE%B9"><span class="toc-number">1.10.9.</span> <span class="toc-text">Redis 集群缩容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-%E9%9B%86%E6%88%90-Redis"><span class="toc-number">1.11.</span> <span class="toc-text">SpringBoot 集成 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jedis-%E9%9B%86%E6%88%90"><span class="toc-number">1.11.1.</span> <span class="toc-text">jedis 集成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lettuce-%E9%9B%86%E6%88%90"><span class="toc-number">1.11.2.</span> <span class="toc-text">Lettuce 集成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RedisTemlate-%E9%9B%86%E6%88%90"><span class="toc-number">1.11.3.</span> <span class="toc-text">RedisTemlate 集成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%8D%95%E6%9C%BA-Redis"><span class="toc-number">1.11.3.1.</span> <span class="toc-text">连接单机 Redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E9%9B%86%E6%88%90-Redis"><span class="toc-number">1.11.3.2.</span> <span class="toc-text">连接集成 Redis</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">2.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-redis/Redis基础" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Redis 基础
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/" class="article-date">
	  <time datetime="2024-12-22T01:57:06.121Z" itemprop="datePublished">2024-12-22</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Redis/" rel="tag">Redis</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="Redis基础"><a href="#Redis基础" class="headerlink" title="Redis基础"></a>Redis基础</h1><h2 id="Redis-入门概述"><a href="#Redis-入门概述" class="headerlink" title="Redis 入门概述"></a>Redis 入门概述</h2><h3 id="Redis-是什么？"><a href="#Redis-是什么？" class="headerlink" title="Redis 是什么？"></a>Redis 是什么？</h3><p>Redis 是一种基于内存的 K-V 键值对缓存数据库。</p>
<h3 id="Redis-能做什么？"><a href="#Redis-能做什么？" class="headerlink" title="Redis 能做什么？"></a>Redis 能做什么？</h3><ul>
<li>分布式缓存，减轻 MySQL 的压力</li>
<li>内存存储和持久化（ROD + AOF）</li>
<li>分布式锁</li>
<li>队列</li>
</ul>
<h3 id="Redis-安装"><a href="#Redis-安装" class="headerlink" title="Redis 安装"></a>Redis 安装</h3><h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 /opt 目录</span></span><br><span class="line">cd /opt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载获取 redis-7.4.1.tar.gz 包</span></span><br><span class="line">wget http://download.redis.io/releases/redis-7.4.1.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压 redis-7.4.1.tar.gz</span></span><br><span class="line">tar -zxvf redis-7.4.1.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入解压后的 redis-7.4.1 目录</span></span><br><span class="line">cd redis-7.4.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行安装命令 打印 Hint: It<span class="string">&#x27;s a good idea to run &#x27;</span>make <span class="built_in">test</span><span class="string">&#x27; ;) 表示成功</span></span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">进入安装的默认目录 /usr/local/bin</span></span></span><br><span class="line">cd /usr/local/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">启动 redis-server</span></span></span><br><span class="line">redis-server</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">启动 redis-cli</span></span></span><br><span class="line">redis-cli</span><br><span class="line">ping # 执行 ping，回应 pong 代表成功</span><br></pre></td></tr></table></figure>

<h4 id="安装踩坑"><a href="#安装踩坑" class="headerlink" title="安装踩坑"></a>安装踩坑</h4><h5 id="踩坑1-：-bin-sh-cc-未找到命令"><a href="#踩坑1-：-bin-sh-cc-未找到命令" class="headerlink" title="踩坑1:：/bin/sh: cc: 未找到命令"></a>踩坑1:：/bin/sh: cc: 未找到命令</h5><p><strong>解决方案：</strong>安装 gcc，执行 <code>yum install gcc-c++ -y</code></p>
<h5 id="踩坑2：zmalloc-h-29-31-致命错误：jemalloc-jemalloc-h：没有那个文件或目录"><a href="#踩坑2：zmalloc-h-29-31-致命错误：jemalloc-jemalloc-h：没有那个文件或目录" class="headerlink" title="踩坑2：zmalloc.h:29:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录"></a>踩坑2：zmalloc.h:29:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录</h5><p>安装完 gcc 后，先将原来解压完成的 redis 文件删掉，重新解压，再执行 <code>make &amp;&amp; make install</code></p>
<h4 id="配置文件配置"><a href="#配置文件配置" class="headerlink" title="配置文件配置"></a>配置文件配置</h4><ol>
<li><p>修改你自己的 redis.conf 文件，在下载的目录下 /opt/redis-7.4.1</p>
<ol>
<li><p>默认 daemonize no 改为 daemonize yes；</p>
<blockquote>
<p>此配置表示是否开启守护线程，开启 redis 则可以在后台运行。</p>
</blockquote>
</li>
<li><p>默认 protected-mode yes   改为 protected-mode no；</p>
<blockquote>
<p>此配置表示是否开启保护模式，保护模式下其他主机的客户端不能连接 redis。</p>
</blockquote>
</li>
<li><p>默认bind 127.0.0.1       改为 直接注释掉(默认bind 127.0.0.1只能本机访问)或改成本机IP地址，否则影响远程IP连接</p>
</li>
<li><p>添加redis密码           改为 requirepass 你自己设置的密码</p>
</li>
</ol>
</li>
<li><p>修改完重启 redis</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/bin/ # 切换到 redis 安装目录</span><br><span class="line"></span><br><span class="line">redis-server /myRedis/redis7.4.conf # 使用更改过的配置重启服务</span><br></pre></td></tr></table></figure></li>
</ol>
<p>官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p>安装教程：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis/install-redis-from-source/">https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis/install-redis-from-source/</a></p>
<blockquote>
<p>安装完之后 redis 的默认目录在 /usr/local/bin</p>
</blockquote>
<h3 id="Redis-卸载"><a href="#Redis-卸载" class="headerlink" title="Redis 卸载"></a>Redis 卸载</h3><ol>
<li><p>启动 redis-cli 停止 redis-server 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure></li>
<li><p>删除 /usr/local/lib 目录下与 redis 相关的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l /usr/local/bin/redis-*</span><br><span class="line">rm -rf /usr/local/bin/redis-*</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Redis-数据类型"><a href="#Redis-数据类型" class="headerlink" title="Redis 数据类型"></a>Redis 数据类型</h2><ul>
<li>String：字符串，最基本的类型，一个 key 对应一个 value，是二进制安全的，可以存储任何数据，最大是 512M。</li>
<li>Hash：哈希，是一个 String 类型的 K-V 映射，特别适合存储对象，Redis 中每个 hash 可以存储 2^32 - 1 键值对（40多亿）。</li>
<li>List：字符串列表，底层实际是双端链表，添加元素可以从列表的头部（左边）或者尾部（右边）插入。</li>
<li>Set：是 String 类型的无序不重复集合，底层通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)，集合中最大的成员数为 2^32 - 1 (4294967295, 每个集合可存储40多亿个成员)。</li>
<li>Sorted Set：有序不重复的集合，和 Set 不同的是每个元素都会关联一个 double 类型的分数，zset 的成员是唯一的，但是分数（score）可以重复。</li>
<li>Stream：流，5.0 之后新家的数据结构，可用于消息队列。</li>
<li>BitMap：由 0 和 1状态表现的二进制 big 数组。</li>
<li>Bitfield：连续的比特位。</li>
<li>Geospatial：主要用于存储地理位置信息，包括对存储的信息进行操作。</li>
<li>HyperLogLog：redis 基数统计，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定且是很小的。</li>
</ul>
<p>官网：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/develop/data-types/">https://redis.io/docs/latest/develop/data-types/</a></p>
<h2 id="Redis-常用命令"><a href="#Redis-常用命令" class="headerlink" title="Redis 常用命令"></a>Redis 常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">keys * # 查看当前库的所有 key</span><br><span class="line">auth &lt;password&gt; # 验证 redis 密码</span><br><span class="line">exists &lt;key&gt; # 判断某个 key 是否存在</span><br><span class="line">type &lt;key&gt; # 查看你的 key 是什么类型</span><br><span class="line">del &lt;key&gt; # 删除指定的 key</span><br><span class="line">unlink &lt;key&gt; # 非阻塞删除，仅仅将 keys 从 keyspace 元数据中删除，真正的删除会在后续异步中操作。</span><br><span class="line">ttl &lt;key&gt; # 查看还有多少秒过期， -1 表示永不过期，-2 表示已过期</span><br><span class="line">expire &lt;key&gt; &lt;seconds&gt; # 为给定的 key 设置过期实际</span><br><span class="line">move &lt;key&gt; &lt;dbIndex&gt; # 将当前数据库的 key 移动到给定的数据库 db 当中</span><br><span class="line">select &lt;dbIndex&gt; # 切换数据库【0-15】，默认为 0</span><br><span class="line">dbsize # 查看当前数据库 key 的数量</span><br><span class="line">flushdb # 清空当前数据库</span><br><span class="line">flushall #清空全部库</span><br><span class="line">help # 帮助实际</span><br><span class="line">help @string # 关于 string 类型的帮助命令，依次类推，@list 则是 list 类型的帮助命令...</span><br></pre></td></tr></table></figure>

<h3 id="String-常用命令"><a href="#String-常用命令" class="headerlink" title="String 常用命令"></a>String 常用命令</h3><h4 id="SET"><a href="#SET" class="headerlink" title="SET"></a>SET</h4><p><code>SET &lt;key&gt; &lt;value&gt; [NX | XX] [GET] [EX seconds | PX milliseconds | EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]</code></p>
<p><strong>必选参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>value：值</li>
</ul>
<p><strong>可选参数说明：</strong></p>
<ul>
<li><code>EX seconds</code>：设置指定的过期时间，以秒为单位（正整数）。</li>
<li><code>PX milliseconds</code> ：设置指定的过期时间，以毫秒为单位（正整数）。</li>
<li><code>EXAT timestamp-seconds</code>：设置指定的Unix时间戳，在此时间戳之后，密钥将过期，以秒为单位（正整数）。</li>
<li><code>PXAT timestamp-milliseconds</code>：设置指定的Unix时间戳，在此时间戳之后，密钥将过期，以毫秒为单位（正整数）。</li>
<li><code>NX</code>：仅在 key 不存在时设置密钥。</li>
<li><code>XX</code>：仅在 key 已存在时设置密钥。</li>
<li><code>KEEPTTL</code>：保留与密钥相关的生存时间。</li>
<li><code>GET</code>： 返回存储在密钥中的旧字符串，或者nil如果密钥不存在。如果存储在密钥中的值不是字符串，则返回错误并中止 SET 操作</li>
</ul>
<h3 id="list-常用命令"><a href="#list-常用命令" class="headerlink" title="list 常用命令"></a>list 常用命令</h3><h4 id="LPUSH"><a href="#LPUSH" class="headerlink" title="LPUSH"></a>LPUSH</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LPUSH &lt;key&gt; &lt;element&gt; [element ...]</span><br></pre></td></tr></table></figure>

<p>将所有指定的值插入到存储为 key 的列表的头部</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>element：要插入的元素</li>
</ul>
<p><strong>可选参数说明：</strong></p>
<ul>
<li>element：元素数组，空格隔开，例：0 1 2 3</li>
</ul>
<h4 id="RPUSH"><a href="#RPUSH" class="headerlink" title="RPUSH"></a>RPUSH</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RPUSH &lt;key&gt; &lt;element&gt; [element ...]</span><br></pre></td></tr></table></figure>

<p>将所有指定的值插入到存储为 key 的列表的尾部</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>element：要插入的元素，可以插入多个，空格隔开，例：0 1 2 3</li>
</ul>
<h4 id="LRANGE"><a href="#LRANGE" class="headerlink" title="LRANGE"></a>LRANGE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的列表的指定元素。 偏移量 start 和 stop 是基于 0 的索引，0 代表列表的第一个元素（列表的头），1 代表下一个元素，以此类推。 这些偏移量也可以是负数，表示从列表的末尾开始的偏移量。 例如，-1 是列表的最后一个元素，-2 是倒数第二个元素，以此类推。</p>
<p><code>lrange key1 0 -1</code>：遍历所有元素</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>start：开始元素下标</li>
<li>end：结束元素的下标，-1 代表最后一个元素</li>
</ul>
<h4 id="LPOP"><a href="#LPOP" class="headerlink" title="LPOP"></a>LPOP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LPOP &lt;key&gt; [count]</span><br></pre></td></tr></table></figure>

<p>删除并返回存储在 key 处的 list 的第一个元素。 默认情况下，该命令从 list 的开头弹出一个元素。 如果提供可选的 count 参数，则根据列表的长度，回复最多包含 count 个元素。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<p><strong>选填参数说明：</strong></p>
<ul>
<li>count：要弹出的数量</li>
</ul>
<h4 id="RPOP"><a href="#RPOP" class="headerlink" title="RPOP"></a>RPOP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RPOP &lt;key&gt; [count]</span><br></pre></td></tr></table></figure>

<p>删除并返回存储在 key 处的列表的最后一个元素。 默认情况下，该命令从列表末尾弹出一个元素。 如果提供了可选的 count 参数，则根据列表的长度，回复最多包含 count 个元素。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<p><strong>选填参数说明：</strong></p>
<ul>
<li>count：要弹出的数量</li>
</ul>
<h4 id="LINDEX"><a href="#LINDEX" class="headerlink" title="LINDEX"></a>LINDEX</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LINDEX &lt;key&gt; &lt;index&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 中的列表中位于 index 索引处的元素。 索引以 0 为单位，因此 0 表示第一个元素，1 表示第二个元素，以此类推。 负索引可用于指定从列表尾部开始的元素。 这里，-1 表示最后一个元素，-2 表示倒数第二个元素，以此类推。 如果 key 处的值不是一个 list，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>index：下标</li>
</ul>
<h4 id="LLEN"><a href="#LLEN" class="headerlink" title="LLEN"></a>LLEN</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLEN &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的 list 的长度。 如果 key 不存在，则将其解释为空列表，并返回 0。 如果 key 中存储的值不是 list，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<h4 id="LREM"><a href="#LREM" class="headerlink" title="LREM"></a>LREM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LREM &lt;key&gt; &lt;count&gt; &lt;element&gt;</span><br></pre></td></tr></table></figure>

<p>从存储在 key 处的列表中移除与元素相同的元素的第一个出现次数。 计数参数对操作的影响如下：</p>
<ul>
<li>count &gt; 0：删除从头部移到尾部的与元素相同的元素。</li>
<li>count &lt; 0：删除从尾部移到头部的与元素相同的元素。 </li>
<li>count = 0：删除所有与元素相同的元素。</li>
</ul>
<p>例如，LREM list -2 “hello” 将删除存储在 list 中的 “hello “的最后两次出现。</p>
<p>请注意，不存在的键将被视为空列表，因此当键不存在时，命令将始终返回 0。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>count：要删除几个对应的元素 &gt; 0 从头部开始删除，&lt; 0 从尾部删除， = 0 删除全部匹配的元素</li>
<li>element：元素名称</li>
</ul>
<h4 id="LTRIM"><a href="#LTRIM" class="headerlink" title="LTRIM"></a>LTRIM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LTRIM &lt;key&gt; &lt;start&gt; &lt;stop&gt;</span><br></pre></td></tr></table></figure>

<p>修剪现有列表，使其只包含指定范围的元素。 start 和 stop 都是基于 0 的索引，其中 0 代表列表的第一个元素（头部），1 代表下一个元素，以此类推。</p>
<p>例如 LTRIM foobar 0 2 将修改存储在 foobar 处的列表，使其只保留列表的前三个元素。</p>
<p>start 和 end 也可以是负数，表示与列表末尾的偏移量，其中 -1 表示列表的最后一个元素，-2 表示倒数第二个元素，以此类推。</p>
<p>超出范围的索引不会产生错误：如果 start 大于 list 的 end，或 start &gt; end，结果将是一个空 list（这会导致 key 被移除）。 如果 end 大于列表末尾，Redis 会将其视为列表的最后一个元素。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>start：开始的下标</li>
<li>stop：结束的下标</li>
</ul>
<h4 id="LSET"><a href="#LSET" class="headerlink" title="LSET"></a>LSET</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LSET &lt;key&gt; &lt;index&gt; &lt;element&gt;</span><br></pre></td></tr></table></figure>

<p>将 index 处的列表元素设置为 element。如果索引超出范围，将返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>index：下标</li>
<li>element：要填充的元素</li>
</ul>
<h4 id="LINSERT"><a href="#LINSERT" class="headerlink" title="LINSERT"></a>LINSERT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LINSERT &lt;key&gt; &lt;BEFORE | AFTER&gt; &lt;pivot&gt; &lt;element&gt;</span><br></pre></td></tr></table></figure>

<p>在键值存储的列表中，在参考值中枢之前或之后插入元素。</p>
<p>如果键不存在，则视为空列表，不执行任何操作。</p>
<p>如果键存在但不包含列表值，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>BEFORE | AFTER：在之前插入还是之后</li>
<li>pivot：参考值中枢</li>
<li>element：要插入的元素</li>
</ul>
<h3 id="hash-常用命令"><a href="#hash-常用命令" class="headerlink" title="hash 常用命令"></a>hash 常用命令</h3><h4 id="HSET"><a href="#HSET" class="headerlink" title="HSET"></a>HSET</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSET &lt;key&gt; &lt;field&gt; &lt;value&gt; [field value ...]</span><br></pre></td></tr></table></figure>

<p>将指定字段设置为存储在 key 中的哈希值。</p>
<p>这条命令会覆盖哈希值中存在的指定字段的值。 如果键不存在，则会创建一个新的散列键。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
<li>value：值</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<p>可 set 多个 字段</p>
<ul>
<li>field：字段名</li>
<li>value：值</li>
</ul>
<h4 id="HGET"><a href="#HGET" class="headerlink" title="HGET"></a>HGET</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HGET &lt;key&gt; &lt;field&gt;</span><br></pre></td></tr></table></figure>

<p>返回键存储的哈希值中与字段相关的值。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
</ul>
<h4 id="HMGET"><a href="#HMGET" class="headerlink" title="HMGET"></a>HMGET</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMGET &lt;key&gt; &lt;field&gt; [field ...]</span><br></pre></td></tr></table></figure>

<p>返回与存储在 key 处的哈希值中指定字段相关的值。</p>
<p>对于哈希值中不存在的每个字段，都会返回一个 nil 值。 由于不存在的键被视为空哈希值，因此针对不存在的键运行 HMGET 将返回一个 nil 值列表。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名，可获取多个字段，空格隔开</li>
</ul>
<h4 id="HGETALL"><a href="#HGETALL" class="headerlink" title="HGETALL"></a>HGETALL</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HGETALL &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的哈希值的所有字段和值。 在返回值中，每个字段名后都有一个值，因此回复的长度是哈希值的两倍。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<h4 id="HDEL"><a href="#HDEL" class="headerlink" title="HDEL"></a>HDEL</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HDEL key field [field ...]</span><br></pre></td></tr></table></figure>

<p>从存储在 key 中的哈希值中删除指定字段。 不存在于散列中的指定字段将被忽略。 如果没有字段，则删除散列。 如果键不存在，则将其视为空散列，此命令返回 0。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名，可删除多个字段，空格隔开</li>
</ul>
<h4 id="HLEN"><a href="#HLEN" class="headerlink" title="HLEN"></a>HLEN</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HLEN &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 中的哈希值所包含字段的数量。</p>
<h4 id="HEXISTS"><a href="#HEXISTS" class="headerlink" title="HEXISTS"></a>HEXISTS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEXISTS &lt;key&gt; &lt;field&gt;</span><br></pre></td></tr></table></figure>

<p>查询某个 key 的字段是否存在，返回 0 表示不存在，返回 1 表示存在。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
</ul>
<h4 id="HKEYS"><a href="#HKEYS" class="headerlink" title="HKEYS"></a>HKEYS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEYS &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的哈希值中的所有字段名。</p>
<h4 id="HVALS"><a href="#HVALS" class="headerlink" title="HVALS"></a>HVALS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HVALS &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回键存储的哈希值中的所有值。</p>
<h4 id="HINCRBY"><a href="#HINCRBY" class="headerlink" title="HINCRBY"></a>HINCRBY</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HINCRBY &lt;key&gt; &lt;field&gt; &lt;increment&gt;</span><br></pre></td></tr></table></figure>

<p>按增量递增存储在 key 的哈希值中的字段数字。 如果 key 不存在，则会创建一个新的哈希值键。 如果字段不存在，则在执行操作前将其值设置为 0。</p>
<p>HINCRBY 支持的数值范围仅限于 64 位有符号整数。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
<li>increment：要递增的数字，可为负数，负数就是递减</li>
</ul>
<h4 id="HINCRBYFLOAT"><a href="#HINCRBYFLOAT" class="headerlink" title="HINCRBYFLOAT"></a>HINCRBYFLOAT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HINCRBYFLOAT &lt;key&gt; &lt;field&gt; &lt;increment&gt;</span><br></pre></td></tr></table></figure>

<p>按指定增量递增存储在键值处的散列指定字段，该字段代表一个浮点数。 如果增量为负值，结果是哈希字段值递减而不是递增。 如果字段不存在，则在执行操作前将其设置为 0。 如果出现以下情况之一，将返回错误信息：</p>
<ul>
<li>键包含错误类型的值（不是哈希值）。</li>
<li>当前字段内容或指定增量无法解析为双精度浮点数。</li>
</ul>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
<li>increment：要递增的浮点数，可为负数，负数就是递减</li>
</ul>
<h4 id="HSETNX"><a href="#HSETNX" class="headerlink" title="HSETNX"></a>HSETNX</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSETNX &lt;key&gt; &lt;field&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>将存储在 key 的哈希值中的字段设置为值，前提是字段还不存在。 如果 key 不存在，则会创建一个新的散列键。 如果字段已经存在，则此操作无效。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>field：字段名</li>
<li>value：要 set 的值</li>
</ul>
<h3 id="set-常用命令"><a href="#set-常用命令" class="headerlink" title="set 常用命令"></a>set 常用命令</h3><h4 id="SADD"><a href="#SADD" class="headerlink" title="SADD"></a>SADD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SADD &lt;key&gt; &lt;member&gt; [member ...]</span><br></pre></td></tr></table></figure>

<p>将指定的成员添加到存储在 key 处的集合中。 已是此集合成员的指定成员将被忽略。 如果 key 不存在，则会先创建一个新集合，然后再添加指定的成员。</p>
<p>如果 key 存储的值不是一个集合，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员，可存储多个，空格隔开</li>
</ul>
<h4 id="SMEMBERS"><a href="#SMEMBERS" class="headerlink" title="SMEMBERS"></a>SMEMBERS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMEMBERS &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的集合值的所有成员。</p>
<h4 id="SISMEMBER"><a href="#SISMEMBER" class="headerlink" title="SISMEMBER"></a>SISMEMBER</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SISMEMBER &lt;key&gt; &lt;member&gt;</span><br></pre></td></tr></table></figure>

<p>返回成员是否是存储在 key 中的集合的成员。0 不存在 1存在</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员</li>
</ul>
<h4 id="SREM"><a href="#SREM" class="headerlink" title="SREM"></a>SREM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SREM &lt;key&gt; &lt;member&gt; [member ...]</span><br></pre></td></tr></table></figure>

<p>从存储在 key 处的集合中删除指定的成员。 不属于此集合的指定成员将被忽略。 如果 key 不存在，则将其视为空集，此命令返回 0。</p>
<p>如果 key 存储的值不是一个集合，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员，可删除多个，用空格隔开</li>
</ul>
<h4 id="SCARD"><a href="#SCARD" class="headerlink" title="SCARD"></a>SCARD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCARD key</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的集合的奇数（元素个数）。</p>
<h4 id="SRANDMEMBER"><a href="#SRANDMEMBER" class="headerlink" title="SRANDMEMBER"></a>SRANDMEMBER</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SRANDMEMBER &lt;key&gt; [count]</span><br></pre></td></tr></table></figure>

<p>如果调用时只有 key 参数，则会从存储在 key 处的集合值中随机返回一个元素。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>count：需要随机返回的元素个数</li>
</ul>
<h4 id="SPOP"><a href="#SPOP" class="headerlink" title="SPOP"></a>SPOP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SPOP &lt;key&gt; [count]</span><br></pre></td></tr></table></figure>

<p>从键值集存储区中删除并返回一个或多个随机成员。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>count：需要随机弹出的元素个数</li>
</ul>
<h4 id="SMOVE"><a href="#SMOVE" class="headerlink" title="SMOVE"></a>SMOVE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMOVE &lt;source&gt; &lt;destination&gt; &lt;member&gt;</span><br></pre></td></tr></table></figure>

<p>将成员从源集合移动到目标集合。 这个操作是原子操作。 在每一个给定时刻，该元素都会成为其他客户端的来源或目的地成员。</p>
<p>如果源集合不存在或不包含指定元素，则不执行任何操作，返回 0。 否则，该元素将从源集合中删除，并添加到目标集合中。 如果指定的元素已经存在于目标集合中，则只会从源集合中删除。</p>
<p>如果源或目标未持有设定值，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>source：源集合</li>
<li>destination：目标集合</li>
<li>member：要移动的成员</li>
</ul>
<h3 id="zset-常用命令"><a href="#zset-常用命令" class="headerlink" title="zset 常用命令"></a>zset 常用命令</h3><h4 id="ZADD"><a href="#ZADD" class="headerlink" title="ZADD"></a>ZADD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZADD &lt;key&gt; [NX | XX] [GT | LT] [CH] [INCR] &lt;score&gt; &lt;member&gt; [score member ...]</span><br></pre></td></tr></table></figure>

<p>将具有指定分数的所有指定成员添加到存储在 key 处的排序集合中。 可以指定多个分数/成员对。 如果指定的成员已经是排序集的成员，则会更新分数，并将元素重新插入正确的位置，以确保排序正确。</p>
<p>如果 key 不存在，则会创建一个以指定成员为唯一成员的新排序集，就像排序集为空一样。 如果键存在，但没有排序集，则会返回错误信息。</p>
<p>分数值应是双精度浮点数的字符串表示。 +inf 和 -inf 值也是有效值。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>score：分数，可新增多个</li>
<li>member：成员，可新增多个</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>XX：只更新已存在的元素。 不要添加新元素</li>
<li>NX：只添加新元素。 不要更新已有元素。</li>
<li>LT：仅在新分数小于当前分数时更新现有元素。 此标记不会阻止添加新元素。</li>
<li>GT：只有当新分数大于当前分数时，才更新现有元素。 此标记不会阻止添加新元素。</li>
</ul>
<blockquote>
<p>注意：GT、LT 和 NX 选项相互排斥。</p>
</blockquote>
<h4 id="ZRANGE"><a href="#ZRANGE" class="headerlink" title="ZRANGE"></a>ZRANGE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt; [BYSCORE | BYLEX] [REV] [LIMIT offset count] [WITHSCORES]</span><br></pre></td></tr></table></figure>

<p>返回存储在 <key> 中的已排序集合的指定元素范围。</key></p>
<p>ZRANGE 可以执行不同类型的范围查询：按索引（秩）、按分数或按词典顺序。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>start：开始范围</li>
<li>stop：结束范围</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>BYSCORE：按分数范围筛选，从小到大排序，正序</li>
<li>REV：按照分数从大到小排序，倒序</li>
<li>WITHSCORES：返回分数信息</li>
</ul>
<p>从 Redis 6.2.0 开始，该命令可替代以下命令： ZREVRANGE、ZRANGEBYSCORE、ZREVRANGEBYSCORE、ZRANGEBYLEX 和 ZREVRANGEBYLEX。</p>
<h4 id="ZSCORE"><a href="#ZSCORE" class="headerlink" title="ZSCORE"></a>ZSCORE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSCORE &lt;key&gt; &lt;member&gt;</span><br></pre></td></tr></table></figure>

<p>返回关键字排序集合中成员的得分。</p>
<p>如果排序集合中不存在成员，或者键不存在，则返回 nil。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员</li>
</ul>
<h4 id="ZCARD"><a href="#ZCARD" class="headerlink" title="ZCARD"></a>ZCARD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCARD key</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的排序集的元素个）。</p>
<h4 id="ZCOUNT"><a href="#ZCOUNT" class="headerlink" title="ZCOUNT"></a>ZCOUNT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCOUNT &lt;key&gt; &lt;min&gt; &lt;max&gt;</span><br></pre></td></tr></table></figure>

<p>返回键值在最小值和最大值之间的排序集合中元素的数量。</p>
<h4 id="ZREM"><a href="#ZREM" class="headerlink" title="ZREM"></a>ZREM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREM &lt;key&gt; &lt;member&gt; [member ...]</span><br></pre></td></tr></table></figure>

<p>从存储在 key 处的排序集合中删除指定的成员。 不存在的成员将被忽略。</p>
<p>如果键存在，但不包含排序集，则会返回错误信息。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员，可删除多个，空格隔开</li>
</ul>
<h4 id="ZINCRBY"><a href="#ZINCRBY" class="headerlink" title="ZINCRBY"></a>ZINCRBY</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZINCRBY &lt;key&gt; &lt;increment&gt; &lt;member&gt;</span><br></pre></td></tr></table></figure>

<p>用增量递增键值存储的排序集合中成员的得分。 如果成员不存在于排序集合中，则会以增量作为其得分（就好像它之前的得分是 0.0）。 如果 key 不存在，则会创建一个以指定成员为唯一成员的新排序集。</p>
<p>当 key 存在但不包含排序集时，将返回错误信息。</p>
<p>得分值应是数值的字符串表示，接受双精度浮点数。 可以提供一个负值来递减分数。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>increment：要增量或减量的分数</li>
<li>member：成员</li>
</ul>
<h4 id="ZRANK"><a href="#ZRANK" class="headerlink" title="ZRANK"></a>ZRANK</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANK key member</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的排序集合中成员的排名，分数从低到高排序。 索引以 0 为基准，即得分最低的成员秩为 0。</p>
<h4 id="ZREVRANK"><a href="#ZREVRANK" class="headerlink" title="ZREVRANK"></a>ZREVRANK</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREVRANK key member</span><br></pre></td></tr></table></figure>

<p>返回存储在 key 处的排序集合中成员的排名，分数从高到低排序。 以 0 为基准，即得分最高的成员秩为 0。</p>
<h4 id="ZMPOP"><a href="#ZMPOP" class="headerlink" title="ZMPOP"></a>ZMPOP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZMPOP &lt;numkeys&gt; key [key ...] &lt;MIN | MAX&gt; [COUNT count]</span><br></pre></td></tr></table></figure>

<p>从提供的键名列表中第一个非空排序集合中跳出一个或多个元素，即成员-分数对。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>numkeys：跳出多少个元素</li>
<li>key：键，可以多个，空格隔开</li>
<li>MIN：从最小的开始跳出</li>
<li>MAX：从最大的开始跳出</li>
<li>count：跳出几个元素</li>
</ul>
<h3 id="bitmap-常用命令"><a href="#bitmap-常用命令" class="headerlink" title="bitmap 常用命令"></a>bitmap 常用命令</h3><h4 id="SETBIT"><a href="#SETBIT" class="headerlink" title="SETBIT"></a>SETBIT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETBIT &lt;key&gt; &lt;offset&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>设置或清除键存储的字符串值中偏移量处的位。</p>
<p>该位的设置或清除取决于值（0 或 1）。</p>
<p>当键不存在时，会创建一个新的字符串值。 字符串的增长是为了确保它能容纳偏移量处的位。 偏移参数必须大于或等于 0，并且小于 2^32（这将位图限制在 512MB）。 当键值处的字符串增长时，增加的位将被设置为 0。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>offset：偏移量，从 0 开始，可以理解为数组下标</li>
<li>value：值，只能为 0 或 1</li>
</ul>
<h4 id="GETBIT"><a href="#GETBIT" class="headerlink" title="GETBIT"></a>GETBIT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GETBIT &lt;key&gt; &lt;offset&gt;</span><br></pre></td></tr></table></figure>

<p>返回键存储的字符串值中偏移量处的位值。</p>
<p>当偏移量超出字符串长度时，字符串会被假定为 0 位的连续空间。 当 key 不存在时，它被假定为空字符串，因此偏移量总是超出范围，值也被假定为 0 位的连续空间。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>offset：偏移量，从 0 开始，可以理解为数组下标</li>
<li>value：值，只能为 0 或 1</li>
</ul>
<h4 id="BITCOUNT"><a href="#BITCOUNT" class="headerlink" title="BITCOUNT"></a>BITCOUNT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>统计键里面含 1 有多少个</p>
<h4 id="BITOP"><a href="#BITOP" class="headerlink" title="BITOP"></a>BITOP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITOP &lt;AND | OR | XOR | NOT&gt; &lt;destkey&gt; &lt;key&gt; [key ...]</span><br></pre></td></tr></table></figure>

<p>用于对一个或多个键中的位图（bitmaps）执行按位操作。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>AND：按位与操作</li>
<li>OR：按位或操作</li>
<li>XOR：按位异或操作</li>
<li>NOT：按位非操作</li>
<li>destkey：目标键，存储操作结果</li>
<li>key [key …]：一个或多个源键</li>
</ul>
<h3 id="HyperLogLog-常用命令"><a href="#HyperLogLog-常用命令" class="headerlink" title="HyperLogLog 常用命令"></a>HyperLogLog 常用命令</h3><h4 id="PFADD"><a href="#PFADD" class="headerlink" title="PFADD"></a>PFADD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFADD &lt;key&gt; [&lt;element&gt; [element ...]]</span><br></pre></td></tr></table></figure>

<p>将所有元素参数添加到存储在第一个参数指定的变量名下的 HyperLogLog 数据结构中。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>element：元素，可以是多个，空格隔开</li>
</ul>
<h4 id="PFCOUNT"><a href="#PFCOUNT" class="headerlink" title="PFCOUNT"></a>PFCOUNT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFCOUNT &lt;key&gt; [key ...]</span><br></pre></td></tr></table></figure>

<p>统计键的 HyperLogLog 个数</p>
<h4 id="PFMERGE"><a href="#PFMERGE" class="headerlink" title="PFMERGE"></a>PFMERGE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFMERGE &lt;destkey&gt; [&lt;sourcekey&gt; [sourcekey ...]]</span><br></pre></td></tr></table></figure>

<p>将多个 HyperLogLog 值合并为一个</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>destkey：要合并的目标 HyperLogLog</li>
<li>sourcekey：源 HyperLogLo，可以是多个，空格隔开</li>
</ul>
<h3 id="GEO-常用命令"><a href="#GEO-常用命令" class="headerlink" title="GEO 常用命令"></a>GEO 常用命令</h3><h4 id="GEOADD"><a href="#GEOADD" class="headerlink" title="GEOADD"></a>GEOADD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD &lt;key&gt; [NX | XX] [CH] &lt;longitude&gt; &lt;latitude&gt; &lt;member&gt; [longitude latitude member ...]</span><br></pre></td></tr></table></figure>

<p>将指定的地理空间项（经度、纬度、名称）添加到指定的键中。 数据将以排序集的形式存储到键中，以便使用 GEOSEARCH 命令查询这些项。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>longitude：经度</li>
<li>latitude：纬度</li>
<li>member：成员</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>XX：只更新已存在的元素。 不要添加新元素</li>
<li>NX：只添加新元素。 不要更新已有元素。</li>
</ul>
<h4 id="GEOPOS"><a href="#GEOPOS" class="headerlink" title="GEOPOS"></a>GEOPOS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOPOS &lt;key&gt; [&lt;member&gt; [member ...]]</span><br></pre></td></tr></table></figure>

<p>返回关键字排序集所代表的地理空间索引中所有指定成员的位置（经度、纬度）。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员，可有多个</li>
</ul>
<h4 id="GEOHASH"><a href="#GEOHASH" class="headerlink" title="GEOHASH"></a>GEOHASH</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOHASH &lt;key&gt; [&lt;member&gt; [member ...]]</span><br></pre></td></tr></table></figure>

<p>返回有效的 Geohash 字符串，表示一个或多个元素在代表地理空间索引（使用 GEOADD 添加元素）的排序集合值中的位置。</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member：成员，可有多个</li>
</ul>
<h4 id="GEODIST"><a href="#GEODIST" class="headerlink" title="GEODIST"></a>GEODIST</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEODIST key member1 member2 [m | km | ft | mi]</span><br></pre></td></tr></table></figure>

<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>member1：成员1</li>
<li>member2：成员2</li>
</ul>
<p>返回排序集所代表的地理空间索引中两个成员之间的距离。</p>
<p>单位必须是以下之一，默认为米： m 表示米。 km 表示公里。 mi 表示英里。</p>
<h4 id="GEOSEARCH"><a href="#GEOSEARCH" class="headerlink" title="GEOSEARCH"></a>GEOSEARCH</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GEOSEARCH key &lt;FROMMEMBER member | FROMLONLAT longitude latitude&gt;</span><br><span class="line">  &lt;BYRADIUS radius &lt;m | km | ft | mi&gt; | BYBOX width height &lt;m | km |</span><br><span class="line">  ft | mi&gt;&gt; [ASC | DESC] [COUNT count [ANY]] [WITHCOORD] [WITHDIST]</span><br><span class="line">  [WITHHASH]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询 city 这个 key 下面 经纬度 121,31 圆形范围 50 千米内的成员</span></span><br><span class="line">geosearch city FROMLONLAT 121 31 BYRADIUS 50 km</span><br></pre></td></tr></table></figure>

<p>返回使用 GEOADD 填充了地理空间信息的排序集合中位于给定形状指定区域边界内的成员。 该命令扩展了 GEORADIUS 命令，因此除了在圆形区域内搜索外，还支持在矩形区域内搜索。</p>
<h3 id="Stream-队列常用命令"><a href="#Stream-队列常用命令" class="headerlink" title="Stream 队列常用命令"></a>Stream 队列常用命令</h3><h4 id="XADD"><a href="#XADD" class="headerlink" title="XADD"></a>XADD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XADD &lt;key&gt; &lt;* | id&gt; &lt;field&gt; &lt;value&gt; [field value ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例子</span></span><br><span class="line">xadd mystream * id 11 name z3</span><br></pre></td></tr></table></figure>

<p>添加消息到队列末尾</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>&lt;* | id&gt;：消息 id，必须要比上一个 id 大，也可以直接使用 * 来自动生成id</li>
<li>field：属性</li>
<li>value：值</li>
</ul>
<h4 id="XRANGE"><a href="#XRANGE" class="headerlink" title="XRANGE"></a>XRANGE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XRANGE &lt;key&gt; &lt;start&gt; &lt;end&gt; [COUNT count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 的所有消息列表</span></span><br><span class="line">xrange mystream - +</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 的一条消息列表</span></span><br><span class="line">xrange mystream - + count 1</span><br></pre></td></tr></table></figure>

<p>获取消息列表</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>start：开始，- 代表最小值</li>
<li>end：结束，+ 代表最大值</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>count：消息条数</li>
</ul>
<h4 id="XREVRANGE"><a href="#XREVRANGE" class="headerlink" title="XREVRANGE"></a>XREVRANGE</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XREVRANGE &lt;key&gt; &lt;end&gt; &lt;start&gt; [COUNT count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 的所有消息列表，倒序排序</span></span><br><span class="line">xrevrange mystream + -</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 的一条消息列表</span></span><br><span class="line">xrevrange mystream + - count 1</span><br></pre></td></tr></table></figure>

<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>start：开始，- 代表最小值</li>
<li>end：结束，+ 代表最大值</li>
</ul>
<p><strong>非必填参数说明：</strong></p>
<ul>
<li>count：消息条数</li>
</ul>
<h4 id="XDEL"><a href="#XDEL" class="headerlink" title="XDEL"></a>XDEL</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XDEL &lt;key&gt; &lt;id&gt; [id ...]</span><br></pre></td></tr></table></figure>

<p>根据 消息id 删除队列中的消息</p>
<p><strong>必填参数说明：</strong></p>
<ul>
<li>key：键</li>
<li>id：消息id</li>
</ul>
<h4 id="XLEN"><a href="#XLEN" class="headerlink" title="XLEN"></a>XLEN</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XLEN &lt;key&gt;</span><br></pre></td></tr></table></figure>

<p>查询队列中的消息条数</p>
<h4 id="XREAD"><a href="#XREAD" class="headerlink" title="XREAD"></a>XREAD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id</span><br><span class="line">  [id ...]</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 中所有消息，0-0 代表从 <span class="built_in">id</span> 最小的消息开始获取</span></span><br><span class="line">xread streams mystream 0-0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 mystream 中两条消息</span></span><br><span class="line">xread count 2 streams mystream 0-0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">阻塞等待获取下一条消息，有消息新增进来，就会解除堵塞</span></span><br><span class="line">xread count 1 block 0 streams mystream $</span><br></pre></td></tr></table></figure>

<p>获取消息，可以设置堵塞/非堵塞，只会返回大于指定 id 的消息</p>
<h3 id="Stream-消费者常用命令"><a href="#Stream-消费者常用命令" class="headerlink" title="Stream 消费者常用命令"></a>Stream 消费者常用命令</h3><h4 id="XGROUP"><a href="#XGROUP" class="headerlink" title="XGROUP"></a>XGROUP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE key group &lt;id | $&gt; [MKSTREAM]</span><br><span class="line">  [ENTRIESREAD entries-read]</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例</span></span><br><span class="line">xgroup create mystream group1 $ </span><br><span class="line">xgroup create mystream group2 0</span><br></pre></td></tr></table></figure>

<p>创建消费组</p>
<p>$表示从Stream尾部开始消费</p>
<p>0表示从Stream头部开始消费</p>
<p>创建消费者组的时候必须指定 ID, ID 为 0 表示从头开始消费，为 $ 表示只消费新的消息，队尾新来</p>
<h4 id="XREADGROUP"><a href="#XREADGROUP" class="headerlink" title="XREADGROUP"></a>XREADGROUP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds]</span><br><span class="line">  [NOACK] STREAMS key [key ...] id [id ...]</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 groupA</span></span><br><span class="line">127.0.0.1:6379&gt; xgroup create mystream groupA 0-0</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取消息队列</span></span><br><span class="line">127.0.0.1:6379&gt; xreadgroup group groupA consumerA streams mystream &gt;</span><br><span class="line">mystream</span><br><span class="line">1732168701463-0</span><br><span class="line">id</span><br><span class="line">11</span><br><span class="line">name</span><br><span class="line">z3</span><br><span class="line">1732169387547-0</span><br><span class="line">id</span><br><span class="line">22</span><br><span class="line">name</span><br><span class="line">l4</span><br><span class="line">id</span><br><span class="line">33</span><br><span class="line">name</span><br><span class="line">w5</span><br><span class="line">1732169423423-0</span><br><span class="line">id</span><br><span class="line">33</span><br><span class="line">name</span><br><span class="line">w5</span><br><span class="line">1732170078845-0</span><br><span class="line">55</span><br><span class="line">k5</span><br></pre></td></tr></table></figure>

<p>读取消息队列</p>
<h4 id="XPENDING"><a href="#XPENDING" class="headerlink" title="XPENDING"></a>XPENDING</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">XPENDING key group [[IDLE min-idle-time] start end count [consumer]]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询 mystream groupA 的消息消费情况</span></span><br><span class="line">127.0.0.1:6379&gt; xpending mystream groupA</span><br><span class="line">4</span><br><span class="line">1732168701463-0</span><br><span class="line">1732170078845-0</span><br><span class="line">consumerA</span><br><span class="line">4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询某个消费者的消息消费情况</span></span><br><span class="line">xpending mystream groupA - + 10 consumerA</span><br><span class="line">1732168701463-0</span><br><span class="line">consumerA</span><br><span class="line">1076309</span><br><span class="line">1</span><br><span class="line">1732169387547-0</span><br><span class="line">consumerA</span><br><span class="line">1076309</span><br><span class="line">1</span><br><span class="line">1732169423423-0</span><br><span class="line">consumerA</span><br><span class="line">1076309</span><br><span class="line">1</span><br><span class="line">1732170078845-0</span><br><span class="line">consumerA</span><br><span class="line">1076309</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>查询消息消费情况</p>
<h4 id="XACK"><a href="#XACK" class="headerlink" title="XACK"></a>XACK</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">XACK key group id [id ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ack 确认了一条消息</span></span><br><span class="line">127.0.0.1:6379&gt; xack mystream groupA 1732169423423-0</span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再查看已经少了一条</span></span><br><span class="line">127.0.0.1:6379&gt; xpending mystream groupA - + 10 consumerA</span><br><span class="line">1732168701463-0</span><br><span class="line">consumerA</span><br><span class="line">1245335</span><br><span class="line">1</span><br><span class="line">1732169387547-0</span><br><span class="line">consumerA</span><br><span class="line">1245335</span><br><span class="line">1</span><br><span class="line">1732170078845-0</span><br><span class="line">consumerA</span><br><span class="line">12453</span><br></pre></td></tr></table></figure>

<p>应答消息已收到</p>
<h4 id="XINFO-STREAM"><a href="#XINFO-STREAM" class="headerlink" title="XINFO STREAM"></a>XINFO STREAM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XINFO STREAM key [FULL [COUNT count]]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例</span></span><br><span class="line">xinfo stream mystream</span><br></pre></td></tr></table></figure>

<p>查询 stream 信息</p>
<h4 id="XINFO-GROUPS"><a href="#XINFO-GROUPS" class="headerlink" title="XINFO GROUPS"></a>XINFO GROUPS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XINFO GROUPS key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例</span></span><br><span class="line">xinfo groups mystream</span><br></pre></td></tr></table></figure>

<p>查询 group 信息</p>
<h4 id="XINFO-CONSUMERS"><a href="#XINFO-CONSUMERS" class="headerlink" title="XINFO CONSUMERS"></a>XINFO CONSUMERS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XINFO CONSUMERS key group</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例，查询 groupA 的消费者信息</span></span><br><span class="line">xinfo consumers mystream groupA</span><br></pre></td></tr></table></figure>

<p>查询消费者信息</p>
<h3 id="BitField-常用命令"><a href="#BitField-常用命令" class="headerlink" title="BitField 常用命令"></a>BitField 常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bitfield key [get type offset]</span><br><span class="line">bitfield key [set type offset value]</span><br><span class="line">bitfield key [incrby type offset value]</span><br></pre></td></tr></table></figure>

<h2 id="Redis-持久化"><a href="#Redis-持久化" class="headerlink" title="Redis 持久化"></a>Redis 持久化</h2><p>持久性是指将数据写入固态硬盘（SSD）等持久存储。 Redis 提供一系列持久性选项。 这些选项包括</p>
<ul>
<li><strong>RDB</strong>(Redis Database): RDB 持久性以指定的时间间隔对数据集执行时间点快照。</li>
<li><strong>AOF</strong>(Append Only File): AOF 持久性记录服务器收到的每个写入操作。 这些操作可以在服务器启动时再次重放，重建原始数据集。 命令记录格式与 Redis 协议本身相同。</li>
<li><strong>No persistence</strong>: 禁用持久性。 </li>
<li><strong>RDB+AOF</strong>: 在同一个实例中同时使用 AOF 和 RDB。</li>
</ul>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>RDB 持久性以指定的时间间隔对数据集执行时间点快照。</p>
<h4 id="快照（Snapshotting）配置和使用说明"><a href="#快照（Snapshotting）配置和使用说明" class="headerlink" title="快照（Snapshotting）配置和使用说明"></a>快照（Snapshotting）配置和使用说明</h4><p>默认情况下，Redis 会将数据集的快照保存在磁盘上一个名为 dump.rdb 的二进制文件中。 你可以对 Redis 进行配置，让它在数据集中至少有 M 次更改时，每 N 秒保存一次数据集，也可以手动调用 <code>SAVE</code> 或 <code>BGSAVE</code> 命令。</p>
<p>例如，如果至少有 1000 个键发生变化，Redis 会每隔 60 秒自动将数据集转储到磁盘：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">快照保存规则</span></span><br><span class="line">save 60 1000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dump.rdb 保存路径</span></span><br><span class="line">dir /myRedis/dumpfiles</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dump.rdb 文件名称</span></span><br><span class="line">dbfilename dump6379.rdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动持久化到 rdb 文件</span></span><br><span class="line">save</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动持久化到 rbd 文件，子线程后台备份</span></span><br><span class="line">bgsave</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取最后一次成功备份的时间戳</span></span><br><span class="line">lastsave</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：save 和 bgsave 的区别</p>
<p><strong>save</strong></p>
<p>SAVE 命令对数据集执行同步保存，以 RDB 文件的形式生成 Redis 实例内所有数据的时间点快照。</p>
<p>在生产环境中，您几乎永远都不想调用 SAVE，因为它会阻塞所有其他客户端。 通常会使用 BGSAVE。 不过，如果出现妨碍 Redis 创建后台保存子进程的问题（例如 fork(2) 系统调用中的错误），SAVE 命令可以作为执行最新数据集转储的最后手段。</p>
<p><strong>bgsave</strong></p>
<p>在后台保存数据库。 Redis 会创建子进程，父节点继续为客户端提供服务，子节点将数据库保存到磁盘上，然后退出。</p>
</blockquote>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>每当 Redis 需要将数据集转储到磁盘时，就会发生这种情况：</p>
<ul>
<li>Redis forks 创建子进程。 现在我们有了一个子进程和一个父进程。</li>
<li>子程序开始将数据集写入临时 RDB 文件。</li>
<li>当子进程写完新的 RDB 文件后，它就会取代旧的 RDB 文件。</li>
</ul>
<h4 id="如何使用-dump-rdb-进行恢复"><a href="#如何使用-dump-rdb-进行恢复" class="headerlink" title="如何使用 dump.rdb 进行恢复"></a>如何使用 dump.rdb 进行恢复</h4><ol>
<li>确保 dump.rdb 在配置文件的路径中存在</li>
<li>重启 redis 即可恢复数据</li>
</ol>
<blockquote>
<p>注意：使用 flushall 或者 flushdb 命令也会产生 dump.rdb 文件，所以如果最后使用了 flushall 或 flushdb 命令，再去进行数据恢复，数据还是空的。</p>
</blockquote>
<h4 id="RDB-的优势"><a href="#RDB-的优势" class="headerlink" title="RDB 的优势"></a>RDB 的优势</h4><ul>
<li>RDB 是 Redis 数据非常紧凑的单文件时间点表示。 RDB 文件非常适合备份。 例如，您可能希望每小时归档最近 24 小时的 RDB 文件，每天保存 RDB 快照，持续 30 天。 这样就可以在发生灾难时轻松恢复数据集的不同版本。</li>
<li>RDB 非常适合灾难恢复，因为它是一个紧凑的文件，可以传输到远处的数据中心或 Amazon S3（可能经过加密）。</li>
<li>RDB 可最大限度地提高 Redis 的性能，因为 Redis 父进程只需分叉一个子进程来完成其余所有工作，就能实现持久化。 父进程永远不会执行磁盘 I/O 或类似操作。</li>
<li>与 AOF 相比，RDB 可以更快地重新启动大型数据集。</li>
<li>在副本上，RDB 支持重启和故障切换后的部分重新同步。</li>
</ul>
<h4 id="RDB-的缺点"><a href="#RDB-的缺点" class="headerlink" title="RDB 的缺点"></a>RDB 的缺点</h4><ul>
<li>如果需要在 Redis 停止工作时（例如停电后）尽量减少数据丢失的几率，那么 RDB 就不太合适。 你可以配置生成 RDB 的不同保存点（例如，数据集至少经过 5 分钟和 100 次写入后，你可以有多个保存点）。 不过，你通常会每五分钟或更长时间创建一次 RDB 快照，因此，如果 Redis 因故停止工作而没有正确关机，你应该做好丢失最近几分钟数据的准备。</li>
<li>如果数据集很大，fork() 可能会很耗时，如果数据集很大且 CPU 性能不佳，可能会导致 Redis 在几毫秒甚至一秒内停止为客户端提供服务。 AOF 也需要 fork()，但频率较低，你可以调整重写日志的频率，而无需牺牲耐用性。</li>
</ul>
<h4 id="检查和修复-rdb-文件"><a href="#检查和修复-rdb-文件" class="headerlink" title="检查和修复 rdb 文件"></a>检查和修复 rdb 文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查命令</span></span><br><span class="line">[root@vm001 dumpfiles] redis-check-rdb dump6379.rdb </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印结果</span></span><br><span class="line">[offset 0] Checking RDB file dump6379.rdb</span><br><span class="line">[offset 26] AUX FIELD redis-ver = &#x27;7.4.1&#x27;</span><br><span class="line">[offset 40] AUX FIELD redis-bits = &#x27;64&#x27;</span><br><span class="line">[offset 52] AUX FIELD ctime = &#x27;1733385931&#x27;</span><br><span class="line">[offset 67] AUX FIELD used-mem = &#x27;1093176&#x27;</span><br><span class="line">[offset 79] AUX FIELD aof-base = &#x27;0&#x27;</span><br><span class="line">[offset 81] Selecting DB ID 0</span><br><span class="line">[offset 121] Checksum OK</span><br><span class="line">[offset 121] \o/ RDB looks OK! \o/</span><br><span class="line">[info] 4 keys read</span><br><span class="line">[info] 0 expires</span><br><span class="line">[info] 0 already expired</span><br><span class="line">[info] 0 subexpires</span><br></pre></td></tr></table></figure>

<h4 id="哪些情况下会出发-RDB-快照"><a href="#哪些情况下会出发-RDB-快照" class="headerlink" title="哪些情况下会出发 RDB 快照"></a>哪些情况下会出发 RDB 快照</h4><ol>
<li>配置文件中默认的快照配置触发</li>
<li>手动执行 save/bgsave 命令</li>
<li>执行 flushall/flushdb 命令也会产生 rdb 文件，但里面的数据是空的，无意义</li>
<li>执行 shutdown 且没有开启 AOF 持久化</li>
<li>主从复制时，主节点自动触发</li>
</ol>
<h4 id="如何禁用快照"><a href="#如何禁用快照" class="headerlink" title="如何禁用快照"></a>如何禁用快照</h4><p>修改 redis.conf 配置，<code>save &quot;&quot;</code></p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241205162624301.png" alt="image-20241205162624301"></p>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>快照并不耐用。 如果运行 Redis 的电脑停机、电源线故障，或者你不小心杀死了实例，写入 Redis 的最新数据就会丢失。 虽然这对某些应用来说可能不是什么大问题，但有些用例需要完全的耐久性，在这种情况下，仅靠 Redis 快照是行不通的。</p>
<p>AOF 持久性记录服务器收到的每个写入操作。 这些操作可以在服务器启动时再次重放，重建原始数据集。 命令记录格式与 Redis 协议本身相同。</p>
<h4 id="AOF-工作流程"><a href="#AOF-工作流程" class="headerlink" title="AOF 工作流程"></a>AOF 工作流程</h4><p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206160055624.png" alt="image-20241206160055624"></p>
<ol>
<li>Client 作为命令的来源，会有多个源头以及源源不断的请求命令。</li>
<li>在这些命令到达Redis Server 以后并不是直接写入 AOF 文件，会将其这些命令先放入AOF 缓存中进行保存。这里的 AOF 缓冲区实际上是内存中的一片区域，存在的目的是当这些命令达到一定量以后再写入磁盘，避免频繁的磁盘 IO 操作。</li>
<li>AOF缓冲会根据AOF缓冲区 <strong>同步文件的三种写回策略</strong> 将命令写入磁盘上的AOF文件。</li>
<li> 随着写入 AOF 内容的增加为避免文件膨胀，会根据规则进行命令的合并(又称 <strong>AOF重写</strong>)，从而起到 AOF 文件压缩的目的。</li>
<li>当 Redis Server 服务器重启的时候会从 AOF 文件载入数据。</li>
</ol>
<h4 id="AOF-缓冲区写回策略"><a href="#AOF-缓冲区写回策略" class="headerlink" title="AOF 缓冲区写回策略"></a>AOF 缓冲区写回策略</h4><ul>
<li>appendfsync always：每次向 AOF 添加新命令时都进行同步。 非常非常慢，但非常安全。 请注意，这些命令是在执行了来自多个客户端或管道的一批命令后追加到 AOF 中的，因此这意味着一次写入和一次同步（在发送回复之前）。</li>
<li>appendfsync everysec: 每秒同步一次。 速度足够快（自 2.4 版以来可能与快照一样快），但如果发生灾难，可能会丢失 1 秒钟的数据。</li>
<li>appendfsync no：绝不同步，只是将数据交由操作系统处理。 这是一种更快但不太安全的方法。 通常情况下，Linux 会在这种配置下每 30 秒刷新一次数据，但这取决于内核的具体调整。</li>
</ul>
<table>
<thead>
<tr>
<th>配置项</th>
<th>写回时机</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>always</td>
<td>同步写回</td>
<td>可靠性高，数据基本不丢失</td>
<td>每个写命令都要落盘，性能影响较大</td>
</tr>
<tr>
<td>everysec</td>
<td>每秒写回</td>
<td>性能适中</td>
<td>宕机时丢失1秒内的数据</td>
</tr>
<tr>
<td>no</td>
<td>操作系统控制的写回</td>
<td>性能好</td>
<td>宕机时丢失数据较多</td>
</tr>
</tbody></table>
<h4 id="AOF-配置和使用说明"><a href="#AOF-配置和使用说明" class="headerlink" title="AOF 配置和使用说明"></a>AOF 配置和使用说明</h4><p>您可以在配置文件中打开 AOF：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启 aof</span></span><br><span class="line">appendonly yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aof 文件名称</span></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aof 文件夹名称</span></span><br><span class="line">appenddirname &quot;appendonlydir&quot;</span><br></pre></td></tr></table></figure>

<p>从现在起，Redis 每次收到更改数据集的命令（如 SET）时，都会将其追加到 AOF 中。 重启 Redis 时，它会重新播放 AOF 以重建状态。</p>
<p>自 Redis 7.0.0 起，Redis 采用了多部分 AOF 机制。 也就是说，原始的单个 AOF 文件被分成基础文件（最多一个）和增量文件（可能不止一个）。 基础文件代表 AOF 重写时数据的初始（RDB 或 AOF 格式）快照。 增量文件包含自上次创建 AOF 基本文件以来的增量变化。 所有这些文件都放在一个单独的目录中，并由清单文件进行跟踪。</p>
<p>AOF 文件目录如下：</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206152122784.png" alt="image-20241206152122784">    </p>
<ul>
<li>appendonly.aof.3.base.rdb 基本文件</li>
<li>appendonly.aof.3.incr.aof 增量文件</li>
<li>appendonly.aof.manifest 清单文件</li>
</ul>
<h4 id="AOF-文件损坏修复"><a href="#AOF-文件损坏修复" class="headerlink" title="AOF 文件损坏修复"></a>AOF 文件损坏修复</h4><p>可能是在写入 AOF 文件时服务器崩溃了，也可能是在写入 AOF 文件时存储 AOF 文件的卷已满。 出现这种情况时，AOF 文件仍包含代表数据集特定时间点版本的一致数据（使用默认的 AOF fsync 策略，时间点版本最长可达一秒），但 AOF 文件中的最后一条命令可能会被截断。 无论如何，最新的 Redis 主要版本都能加载 AOF，只是会丢弃文件中最后一条不完整的命令。 在这种情况下，服务器会发出如下日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* Reading RDB preamble from AOF file...</span><br><span class="line">* Reading the remaining AOF tail...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">!!! Warning: short <span class="built_in">read</span> <span class="keyword">while</span> loading the AOF file !!!</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">!!! Truncating the AOF at offset 439 !!!</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">AOF loaded anyway because aof-load-truncated is enabled</span></span><br></pre></td></tr></table></figure>

<p>执行如下命令修复 aof 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<h4 id="AOF-优势"><a href="#AOF-优势" class="headerlink" title="AOF 优势"></a>AOF 优势</h4><ul>
<li>使用 AOF Redis 则更耐用：你可以使用不同的同步策略：完全不执行同步、每秒执行同步、每次都执行同步。 同步是使用后台线程执行的，主线程会在没有同步的情况下努力执行写入操作，因此只会损失一秒钟的写入量。</li>
<li>AOF 日志是一种仅附录的日志，因此不会出现寻道问题，也不会在断电时出现损坏问题。 即使由于某种原因（磁盘已满或其他原因），日志以写了一半的命令结束，redis-check-aof 工具也能轻松修复。</li>
<li>当 AOF 文件过大时，Redis 可以在后台自动重写。 重写是完全安全的，因为 Redis 在继续向旧文件追加内容的同时，会使用创建当前数据集所需的最少操作集生成一个全新的文件，一旦第二个文件准备就绪，Redis 就会切换这两个文件，并开始向新文件追加内容。</li>
<li>AOF 包含以易于理解和解析的格式逐一记录的所有操作日志。 您甚至可以轻松导出 AOF 文件。 例如，即使你不小心使用 FLUSHALL 命令刷新了所有内容，只要在此期间没有重写日志，你仍然可以通过停止服务器、删除最新命令并重新启动 Redis 来保存数据集。</li>
</ul>
<h4 id="AOF-劣势"><a href="#AOF-劣势" class="headerlink" title="AOF 劣势"></a>AOF 劣势</h4><ul>
<li>对于相同的数据集，AOF 文件通常比相应的 RDB 文件大。</li>
<li>AOF 可能比 RDB 慢，这取决于具体的同步策略。 一般来说，当 fsync 设置为每秒一次时，AOF 的性能仍然很高，而当 fsync 禁用时，即使在高负载情况下，AOF 的速度也应该与 RDB 完全一样快。 不过，即使在写入负载很大的情况下，RDB 也能提供更多关于最大延迟的保证。</li>
</ul>
<h4 id="AOF-重写机制"><a href="#AOF-重写机制" class="headerlink" title="AOF 重写机制"></a>AOF 重写机制</h4><p>随着写入操作的进行，AOF 会越来越大。 例如，如果一个计数器递增了 100 次，那么数据集中就会有一个包含最终值的键，但 AOF 中会有 100 个条目。 其中 99 个条目不需要重建当前状态。</p>
<p>重写是完全安全的。 Redis 在继续向旧文件追加内容的同时，会使用创建当前数据集所需的最少操作集生成一个全新的文件，一旦第二个文件准备就绪，Redis 就会切换这两个文件，并开始向新文件追加内容。</p>
<p>因此，Redis 支持一个有趣的功能：它能够在后台重建 AOF，而不会中断对客户端的服务。 每当你发出 BGREWRITEAOF 命令，Redis 就会写入重建内存中当前数据集所需的最短命令序列。 如果你在 Redis 2.2 中使用 AOF，就需要不时运行 BGREWRITEAOF。 因为 Redis 2.4 能够自动触发日志重写（更多信息请参阅示例配置文件）。</p>
<p>自 Redis 7.0.0 起，当计划进行 AOF 重写时，Redis 父进程会打开一个新的增量 AOF 文件继续写入。 子进程执行重写逻辑并生成新的基础 AOF。 Redis 将使用临时清单文件来跟踪新生成的基础文件和增量文件。 当它们准备就绪时，Redis 会执行原子替换操作，使临时清单文件生效。 为了避免 AOF 重写重复失败和重试时创建大量增量文件的问题，Redis 引入了 AOF 重写限制机制，确保失败的 AOF 重写以越来越慢的速度重试。</p>
<h5 id="AOF-重写机制配置"><a href="#AOF-重写机制配置" class="headerlink" title="AOF 重写机制配置"></a>AOF 重写机制配置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据上次重写后的aof大小，判断当前aof大小是不是增长了1倍</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重写时满足的文件大小</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重写期间是否同步</span></span><br><span class="line">no-appendfsync-on-rewrite no</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该配置需要两者都满足，才会<strong>自动触发</strong> AOF 重写</p>
</blockquote>
<h5 id="手动出发-AOF-重写"><a href="#手动出发-AOF-重写" class="headerlink" title="手动出发 AOF 重写"></a>手动出发 AOF 重写</h5><p>使用 BGREWRITEAOF 命令</p>
<h3 id="RDB-AOF-混合持久化"><a href="#RDB-AOF-混合持久化" class="headerlink" title="RDB+AOF 混合持久化"></a>RDB+AOF 混合持久化</h3><p>如果你希望获得与 PostgreSQL 相当的数据安全性，那么一般来说，你应该同时使用这两种持久化方法。</p>
<p>如果你非常关心数据，但仍能忍受灾难发生时几分钟的数据丢失，那么你可以只使用 RDB。</p>
<p>有许多用户只使用 AOF，但我们不鼓励他们这样做，因为不时制作一个 RDB 快照对于进行数据库备份、更快地重新启动以及在 AOF 引擎出现错误时都是一个不错的主意。</p>
<h4 id="数据恢复时的顺序和流程"><a href="#数据恢复时的顺序和流程" class="headerlink" title="数据恢复时的顺序和流程"></a>数据恢复时的顺序和流程</h4><p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241206153110134.png" alt="image-20241206153110134">    </p>
<p>同时开启 RDB 和 AOF 时，重启只会加载 aof 文件，不会加载 rdb 文件</p>
<h4 id="开启-RDB-AOF-的配置"><a href="#开启-RDB-AOF-的配置" class="headerlink" title="开启 RDB+AOF 的配置"></a>开启 RDB+AOF 的配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">yes</span> 表示开启，no 表示禁用</span></span><br><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>

<p>结论：RDB 镜像做全量持久化，AOF 做增量持久化</p>
<h3 id="纯缓存模式"><a href="#纯缓存模式" class="headerlink" title="纯缓存模式"></a>纯缓存模式</h3><p>同时关闭 RDB 和 AOF，在配置配置 <code>save &quot;&quot;</code> 和 <code>appendonly yes</code> 即可。</p>
<p>虽然同时关闭了 RDB 和 AOF，只是不会自动持久化，但还是可以通过 <code>SAVE/BGSAVE</code> 和 <code>BGREWRITEAOF</code>命令来手动持久化</p>
<h2 id="Redis-事务"><a href="#Redis-事务" class="headerlink" title="Redis 事务"></a>Redis 事务</h2><p>客户端通常会执行一系列命令，对数据对象进行一系列相关更改。 然而，另一个客户机也可能修改相同的数据对象，并在中间执行类似的命令。 这种情况会造成数据损坏或不一致。</p>
<p>使用事务可将来自客户端的多个命令组合为一个单元。 事务中的命令保证按顺序执行，不会受到其他客户端命令的干扰。</p>
<p>在执行事务之前，还可以使用 WATCH 命令检查事务中使用的键是否发生变化。 如果在构建事务的过程中观察到的数据发生了变化，就会安全地中止执行。 在通常情况下，每次只有一个客户端访问数据，使用此功能可实现高效的乐观并发控制。</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li>MULTI: 开启事务</li>
<li>EXEC: 执行事务</li>
<li>DISCARD: 取消事务</li>
<li>WATCH: 监视一个 key 或多个 key，如果事务执行之前这个 key 被其他命令所改动，那么事务将被打断</li>
<li>UNWATCH: 取消监视</li>
</ul>
<h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3><p>使用 <code>MULTI</code> 命令输入 Redis 事务。 该命令的回复总是 OK。 此时，用户可以发出多条命令。 Redis 不会执行这些命令，而是将它们排成队列。 一旦调用 <code>EXEC</code>，所有命令都会执行。</p>
<p>而调用 <code>DISCARD</code> 会清空事务队列并退出事务。</p>
<p>例1：正常使用事务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; INCR count </span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) (integer) 1</span><br></pre></td></tr></table></figure>

<p>例2：取消事务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get count</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v11&quot;</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v111</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v222</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; discard</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v11&quot;</span><br></pre></td></tr></table></figure>

<h3 id="事务中的错误"><a href="#事务中的错误" class="headerlink" title="事务中的错误"></a>事务中的错误</h3><p>在事务过程中，可能会遇到两种命令错误：</p>
<ul>
<li>命令可能排队失败，因此在调用 EXEC 之前可能会出现错误。 例如，命令可能语法错误（参数数量错误、命令名称错误……），或者可能出现一些关键情况，如内存不足（如果服务器使用 maxmemory 指令配置了内存限制）。</li>
<li>调用 EXEC 后，命令可能会失败，例如，我们对一个值错误的键执行了操作（如对一个字符串值调用列表操作）。</li>
</ul>
<p>例1：命令语法错误</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v111</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v222</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k3</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;set&#x27; command</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果队列内有错误的命令，会直接丢弃整个事务</p>
</blockquote>
<p>例2：命令语法正确，但执行过程中发生错误</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v11&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;v22&quot;</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v111</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incr k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an integer or out of range</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v111&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;v22&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果命令语法正确，但执行过程中发生失败（如对一个字符串类型进行递增操作），事务中正确的命令依然执行，不会直接抛弃整个事务。</p>
</blockquote>
<h3 id="事务监控"><a href="#事务监控" class="headerlink" title="事务监控"></a>事务监控</h3><p><code>WATCH</code> 用于为 Redis 事务提供检查和设置（CAS）行为。</p>
<p>WATCHed 密钥受到监控，以检测针对它们的更改。 如果在 <code>EXEC</code> 命令之前至少有一个被监视的键被修改，整个事务就会中止，<code>EXEC</code> 会返回一个 Null 回复，通知事务失败。</p>
<p>例1：</p>
<ol>
<li>客户端1：客户端1 对 k1 进行了 watch 操作，并开启了事务准备更新 k1。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; WATCH k1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v222</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>客户端2：直接对 k1 进行了更新。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v111&quot;</span><br><span class="line">127.0.0.1:6379&gt; set k1 v11111111</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>客户端1：执行 exec 命令提交事务，由于 k1 已经被修改了，所以此次更新无效，获取的是客户端2 更新之后的值。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v11111111&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>UNWATCH</code> 是 <code>WATCH</code> 的反向操作，例如客户端1 发现 k1 已经被客户端2 修改之后，可以使用 <code>UNWATCH</code> 取消监视。</p>
</blockquote>
<h3 id="Redis-事务和-MySQL-事务的区别"><a href="#Redis-事务和-MySQL-事务的区别" class="headerlink" title="Redis 事务和 MySQL 事务的区别"></a>Redis 事务和 MySQL 事务的区别</h3><ul>
<li>单独的隔离操作</li>
<li>没有隔离级别的概念：在事务提交之前不会有任何命令执行。</li>
<li>不保证原子性：不能保证事务中的所有执行都同时成功或失败，没有事务回滚的能力。</li>
<li>排它性：会保证一个事务内的命令依次执行，而不会被其他命令插入。</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>Redis 事务执行的三个步骤：</p>
<ul>
<li>开启：执行 <code>MULTI</code> 命令开启一个事务</li>
<li>入队：将多个命令入队到事务中，接到这些命令不会立即执行，而是放到等待执行的事务队列里面。</li>
<li>执行：执行 <code>EXEC</code> 命令，将事务队列中的命令批量执行。</li>
</ul>
<h2 id="Redis-管道（pipelining）"><a href="#Redis-管道（pipelining）" class="headerlink" title="Redis 管道（pipelining）"></a>Redis 管道（pipelining）</h2><p>如何通过批处理 Redis 命令优化往返时间</p>
<p>Redis 管道化是一种提高性能的技术，它可以同时发出多条命令，而无需等待每条命令的响应。 </p>
<blockquote>
<p>重要提示：客户端使用流水线方式发送命令时，服务器将被迫对回复进行排队，从而占用内存。 因此，如果需要使用流水线发送大量命令，最好以批量方式发送，每批包含合理数量的命令，例如 10k 条命令，读取回复后再发送 10k 条命令，如此反复。 这样的速度几乎是一样的，但所增加的内存最多也就是为这 10k 条命令的回复排队所需的内存量。</p>
</blockquote>
<p>管道操作案例：先准备好一个命令合集的 txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@vm001 myRedis]# cat cmd.txt </span><br><span class="line">set k100 v100</span><br><span class="line">set k200 v200</span><br><span class="line">hset k300 name haha</span><br><span class="line">hset k300 age 20</span><br><span class="line">hset k300 gender male</span><br><span class="line">[root@vm001 myRedis]# cat cmd.txt | redis-cli -a Passw0rd --pipe</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">All data transferred. Waiting for the last reply...</span><br><span class="line">Last reply received from server.</span><br><span class="line">errors: 0, replies: 5</span><br></pre></td></tr></table></figure>

<h3 id="管道和原生命令的对比"><a href="#管道和原生命令的对比" class="headerlink" title="管道和原生命令的对比"></a>管道和原生命令的对比</h3><ul>
<li>原生批量命令是原子性（例如：mset,mget），管道是非原子性。</li>
<li>原生批量命令一次只能执行一种命令，管道支持批量执行不同命令。</li>
<li>原生批量命令是服务端实现，而管道需要服务端和客户端共同完成。</li>
</ul>
<h2 id="Redis-发布订阅（Pub-Sub）"><a href="#Redis-发布订阅（Pub-Sub）" class="headerlink" title="Redis 发布订阅（Pub/Sub）"></a>Redis 发布订阅（Pub/Sub）</h2><h2 id="Redis-复制（replica）"><a href="#Redis-复制（replica）" class="headerlink" title="Redis 复制（replica）"></a>Redis 复制（replica）</h2><h3 id="Redis-复制是什么"><a href="#Redis-复制是什么" class="headerlink" title="Redis 复制是什么"></a>Redis 复制是什么</h3><p>Redis 如何通过复制支持高可用性和故障转移</p>
<p>在 Redis 复制的基础上，有一个易于使用和配置的领导者跟随者（主副本）复制。它允许 Redis 副本实例成为主实例的精确副本。每次链接断开时，副本都会自动重新连接到主服务器，并且无论主服务器发生什么情况，都会尝试成为主服务器的精确副本。</p>
<h3 id="Redis-复制的工作机制"><a href="#Redis-复制的工作机制" class="headerlink" title="Redis 复制的工作机制"></a>Redis 复制的工作机制</h3><p>该系统使用三种主要机制来工作：</p>
<ol>
<li>当主实例和副本实例连接良好时，主实例通过向副本发送命令流来复制主实例上发生的数据集影响，从而保持副本更新，因为：客户端写入、密钥过期或被逐出、更改主数据集的任何其他操作。</li>
<li>当主服务器和副本服务器之间的链路由于网络问题或在主服务器或副本服务器中检测到超时而断开时，副本服务器会重新连接并尝试继续进行部分重新同步：这意味着它将尝试仅获取该部分在断开连接期间丢失的命令流。</li>
<li>当部分重新同步不可能时，副本将请求完全重新同步。这将涉及一个更复杂的过程，其中主服务器需要创建其所有数据的快照，将其发送到副本，然后在数据集发生变化时继续发送命令流。</li>
</ol>
<p>Redis 默认使用异步复制，具有低延迟和高性能的特点，是绝大多数 Redis 使用场景的自然复制模式。但是，Redis 副本会异步确认它们定期与主服务器接收的数据量。因此，主服务器不会每次都等待副本处理命令，但如果需要，它知道哪个副本已经处理了哪个命令。这允许具有可选的同步复制。</p>
<p>客户端可以使用 <code>WAIT</code>命令请求同步复制某些数据。然而， <code>WAIT</code> 只能确保其他 Redis 实例中存在指定数量的已确认副本，它并不能将一组 Redis 实例变成具有强一致性的 CP 系统：在故障转移期间，已确认的写入仍然可能会丢失，具体取决于Redis持久化的具体配置。然而， <code>WAIT</code> 极大地降低了在特定的难以触发的故障模式发生故障事件后丢失写入的可能性。</p>
<h3 id="Redis-复制的特性"><a href="#Redis-复制的特性" class="headerlink" title="Redis 复制的特性"></a>Redis 复制的特性</h3><ul>
<li>Redis 使用异步复制，异步副本到主服务器确认处理的数据量。</li>
<li>一个主服务器可以有多个副本。</li>
<li>副本能够接受来自其他副本的连接。除了将多个副本连接到同一个主节点之外，副本还可以以级联结构连接到其他副本。从Redis 4.0开始，所有子副本都会从主副本接收完全相同的复制流。</li>
<li>Redis 复制在主端是非阻塞的。这意味着当一个或多个副本执行初始同步或部分重新同步时，主服务器将继续处理查询。</li>
<li>复制在副本端也基本上是非阻塞的。当副本执行初始同步时，它可以使用旧版本的数据集处理查询（假设您在 redis.conf 中将 Redis 配置为这样做）。否则，您可以将 Redis 副本配置为在复制流关闭时向客户端返回错误。但是，在初始同步后，必须删除旧数据集并加载新数据集。副本将在此短暂窗口期间阻止传入连接（对于非常大的数据集，该窗口可能长达数秒）。从 Redis 4.0 开始，您可以配置 Redis，以便在不同的线程中删除旧数据集，但加载新的初始数据集仍将在主线程中发生并阻塞副本。</li>
<li>复制既可用于可扩展性，为只读查询提供多个副本（例如，可以将慢速 O(N) 操作卸载到副本），也可仅用于提高数据安全性和高可用性。</li>
<li>您可以使用复制来避免主服务器将完整数据集写入磁盘的成本：典型的技术包括配置主服务器<code>redis.conf</code>以避免持久保存到磁盘，然后连接配置为不时保存的副本，或者启用 AOF 后。但是，必须小心处理此设置，因为重新启动的主服务器将从空数据集开始：如果副本尝试与其同步，则副本也将被清空。</li>
</ul>
<h3 id="Redis-复制的配置"><a href="#Redis-复制的配置" class="headerlink" title="Redis 复制的配置"></a>Redis 复制的配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 redis.conf 中新增 replicaof 配置</span></span><br><span class="line">replicaof 192.168.1.1 6379</span><br></pre></td></tr></table></figure>

<h3 id="Redis-复制的常用命令"><a href="#Redis-复制的常用命令" class="headerlink" title="Redis 复制的常用命令"></a>Redis 复制的常用命令</h3><p>配从不配主</p>
<ul>
<li><code>info replication</code>: 可以查看复制节点的主从关系和配置信息</li>
<li><code>replicaof 主库ip 主库端口</code>: 配置主库信息，一般写入 redis.conf 里</li>
<li><code>slaveof 主库ip 主库端口</code>: 在运行期间修改 slave 节点信息</li>
<li><code>slaveof no one</code>: 使当前数据库停止与其他数据库同步，转成主库</li>
</ul>
<h3 id="Redis-工作流程和原理"><a href="#Redis-工作流程和原理" class="headerlink" title="Redis 工作流程和原理"></a>Redis 工作流程和原理</h3><ul>
<li>slave 启动，同步初请：slave 启动成功连接到 master 后会发送一个 sync 命令，slave 首次全新连接 master，一次完全同步（全量复制）将被自动执行，slave 自身原有数据会被 master 数据覆盖清楚</li>
<li>首次连接，全量复制：master 节点收到同步命令后会开始在后台保存 RDB 快照，同时收集所有接收到的用于修改数据集的命令缓存起来，master 节点执行完 RDB 持久化后，master 将 rdb 快照文件和所有缓存的命令发送到 slave，以完成一次完全同步</li>
<li>心跳持续，保持通信：master 默认 10 秒会对 slave 发出 ping 请求，用于心跳检测</li>
<li>进入平稳，增量复制：master 继续将心的所有收集到的修改命令自动依次传给 slave，完成同步</li>
<li>从机下线，重连续传：master 会检查 backlog 里面的 offset，master 和 slave 都会保存一个复制的 offset 还有一个 masterId，offset 是保存在 backlog 中的。master 只会把已经复制的 offset 后面的数据复制给 slave，类似断点续传。</li>
<li>主机删除 key 时，从机也会同步删除</li>
</ul>
<h3 id="Redis-复制的缺点"><a href="#Redis-复制的缺点" class="headerlink" title="Redis 复制的缺点"></a>Redis 复制的缺点</h3><ul>
<li>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</li>
<li>master 挂了每次都需要人工干预（无人值守变成刚需）</li>
</ul>
<h2 id="Redis-哨兵（sentinel）"><a href="#Redis-哨兵（sentinel）" class="headerlink" title="Redis 哨兵（sentinel）"></a>Redis 哨兵（sentinel）</h2><h3 id="Redis-哨兵是什么"><a href="#Redis-哨兵是什么" class="headerlink" title="Redis 哨兵是什么"></a>Redis 哨兵是什么</h3><p>哨兵巡查监控后台 master 主机是否故障，如果故障了根据 <strong>投票数</strong> 自动将一个从库转为新主库，继续对外服务。</p>
<h3 id="Redis-哨兵的作用"><a href="#Redis-哨兵的作用" class="headerlink" title="Redis 哨兵的作用"></a>Redis 哨兵的作用</h3><ul>
<li>监控：哨兵会不断检查您的主实例和副本实例是否按预期工作</li>
<li>通知：哨兵可以通过 API 通知系统管理员或其他计算机程序，其中一个受监视的 Redis 实例有问题。</li>
<li>故障转移：如果主服务器未按预期工作，Sentinel 可以启动故障转移过程，其中副本被提升为主服务器，其他其他副本被重新配置以使用新的主服务器，并且使用 Redis 服务器的应用程序在连接时被告知要使用的新地址。</li>
<li>配置提中心：哨兵充当客户端服务发现的授权来源：客户端连接到 Sentinels 以请求负责给定服务的当前 Redis master 的地址。如果发生故障转移，哨兵将报告新地址。</li>
</ul>
<blockquote>
<p>注意：哨兵选举完成后会修改 redis.conf 和 sentinel.conf</p>
</blockquote>
<h3 id="Redis-哨兵配置说明"><a href="#Redis-哨兵配置说明" class="headerlink" title="Redis 哨兵配置说明"></a>Redis 哨兵配置说明</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置要监控的 master 服务器 &lt;quorum&gt; 表示投票数，表示最少有几个哨兵认可主机客观下线，同步故障迁移的法定票数。</span></span><br><span class="line">sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">master 设置了密码，连接 master 服务的密码</span></span><br><span class="line">sentinel auth-pass &lt;master-name&gt; &lt;passwod&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Redis-哨兵的运行原理"><a href="#Redis-哨兵的运行原理" class="headerlink" title="Redis 哨兵的运行原理"></a>Redis 哨兵的运行原理</h3><h4 id="哨兵运行流程"><a href="#哨兵运行流程" class="headerlink" title="哨兵运行流程"></a>哨兵运行流程</h4><ol>
<li><p>哨兵会持续跟 Redis 实例保存通信，发送心跳检测</p>
</li>
<li><p>主观下线：指的是单个 Sentinel 实例对服务器做出的下线判断，即单个sentinel认为某个服务下线（有可能是接收不到订阅，之间的网络不通等等原因）。主观下线就是说如果服务器在 [sentinel down-after-milliseconds] 给定的毫秒数之内没有回应PING命令或者返回一个错误消息， 那么这个Sentinel会主观的(单方面的)认为这个master不可以用了。</p>
</li>
<li><p>客观下线：多个 sentinel 实例达成一致意见，任务一个 master 客观上已经宕掉。</p>
</li>
<li><p>当主节点被判断客观下线以后，各个哨兵节点会进行协商，先选出一个领导者哨兵节点（兵王，通过 Raft 算法选举出来的，先到先得）并由该领导者节点进行故障迁移。</p>
</li>
<li><p>由兵王开始推动故障迁移流程并选出一个新 master</p>
</li>
</ol>
<h4 id="新-master-选举流程"><a href="#新-master-选举流程" class="headerlink" title="新 master 选举流程"></a>新 master 选举流程</h4><ol>
<li>根据选举规则选出新 master，规则如下<ul>
<li>与主机断开连接的时间</li>
<li>根据 redis.conf 的 slave-priority 或者 replica-priority 从最高的从节点（数据越少优先级越高）</li>
<li>复制偏移量 offeset 最大的节点</li>
<li>最小 Run ID 从节点</li>
</ul>
</li>
<li>哨兵 leader 给 新 masetr 发送 slaveof no one 成为主节点，并对其他从节点发送 slaveof 命令成为其从节点</li>
<li>老 master 恢复之后，哨兵 leader 会让老 master 降级为新 master 的 slave</li>
</ol>
<h3 id="哨兵使用建议"><a href="#哨兵使用建议" class="headerlink" title="哨兵使用建议"></a>哨兵使用建议</h3><ul>
<li>哨兵节点数量应为多个，哨兵本身应该是集群，保证高可用。</li>
<li>哨兵节点的数量应该是奇数。</li>
<li>各个哨兵节点的配置应一致。</li>
<li>如果哨兵节点部署在 Docker 等容器里面，尤其要注意端口的正确映射</li>
<li>哨兵集群+主从复制，并不能保证数据零丢失</li>
</ul>
<h2 id="Redis-集群（cluster）"><a href="#Redis-集群（cluster）" class="headerlink" title="Redis 集群（cluster）"></a>Redis 集群（cluster）</h2><h3 id="Redis-集群分片"><a href="#Redis-集群分片" class="headerlink" title="Redis 集群分片"></a>Redis 集群分片</h3><h4 id="分片是什么？"><a href="#分片是什么？" class="headerlink" title="分片是什么？"></a>分片是什么？</h4><p>使用 Redis 集群时我们会将存储的数据分散到多台 redis 机器上，这称为分片。简言之，集群中的每个 Redis 实例都被认为是整个数据的一个分片。</p>
<h4 id="如何找到给定-key-的分片？"><a href="#如何找到给定-key-的分片？" class="headerlink" title="如何找到给定 key 的分片？"></a>如何找到给定 key 的分片？</h4><p>为了找到给定 key 的分片，我对 key 进行 CRC16(key) 算法处理并通过对总分片数量取模。然后，<strong>使用确定性哈希函数</strong>，这意味着给定的 key <strong>将多次始终映射到同一分片</strong>，我们可以推断将来读取特定 key 的位置。</p>
<h3 id="Redis-集群的槽位-slot"><a href="#Redis-集群的槽位-slot" class="headerlink" title="Redis 集群的槽位 slot"></a>Redis 集群的槽位 slot</h3><p>Redis集群不使用一致性哈希，而是一种不同形式的分片，其中每个键在概念上都是我们所说的<strong>哈希槽</strong>的一部分。</p>
<p>Redis集群中有16384个哈希槽，要计算给定密钥的哈希槽，我们只需取密钥的CRC 16模16384。</p>
<p>Redis集群中的每个节点都负责哈希槽的一个子集，所以，例如，你可能有一个3节点的集群，其中：</p>
<ul>
<li>节点A包含从0到5500的散列槽。</li>
<li>节点B包含从5501到11000的散列槽。</li>
<li>节点C包含从11001到16383的散列槽。</li>
</ul>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216232223472.png" alt="image-20241216232223472"></p>
<p><strong>优势：</strong></p>
<p>这使得添加和删除群集节点变得很容易。例如，如果我想添加一个新的节点D，我需要将一些哈希槽从节点A、B、C移动到D。类似地，如果我想从集群中删除节点A，我可以将A服务的哈希槽移动到B和C。一旦节点A为空，我就可以将其从集群中完全删除。</p>
<p>将哈希槽从一个节点移动到另一个节点不需要停止任何操作;因此，添加和删除节点或更改节点持有的哈希槽的百分比不需要停机时间。</p>
<h4 id="slot-槽位映射的三种解决方案"><a href="#slot-槽位映射的三种解决方案" class="headerlink" title="slot 槽位映射的三种解决方案"></a>slot 槽位映射的三种解决方案</h4><h5 id="哈希取余分区"><a href="#哈希取余分区" class="headerlink" title="哈希取余分区"></a>哈希取余分区</h5><p>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：</p>
<p><strong>hash(key) % N个机器台数</strong>，计算出哈希值，用来决定数据映射到哪一个节点上</p>
<p><strong>优点：</strong></p>
<p> 简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。</p>
<p><strong>缺点：</strong></p>
<p>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。</p>
<p>某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</p>
<h5 id="一致性哈希算法分区"><a href="#一致性哈希算法分区" class="headerlink" title="一致性哈希算法分区"></a>一致性哈希算法分区</h5><p><strong>一致性Hash算法背景：</strong></p>
<p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</p>
<p> 算法三大步骤：</p>
<ul>
<li><p>构建一致性哈希环</p>
<p>一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。 </p>
<p>它也是按照使用取模的方法，<strong>前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32 取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环</strong>，如假设某哈希函数H的值空间为0-2^32 -1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间<strong>按顺时针方向组织</strong>，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32 -1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32 -1在零点中方向重合，我们把这个由2^32 个点组成的圆环称为Hash环</p>
</li>
</ul>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234631630.png" alt="image-20241216234631630">    </p>
<ul>
<li><p>redis 服务器 ip 节点映射</p>
<p>将集群中各个IP节点映射到环上的某一个位置。</p>
<p> 将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下： </p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234800372.png" alt="image-20241216234800372">    </p>
</li>
<li><p>key 落到服务器的落键规则</p>
<p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，<strong>从此位置沿环顺时针“行走”</strong>，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。</p>
<p>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234831601.png" alt="image-20241216234831601">    </p>
</li>
</ul>
<p><strong>优点：</strong></p>
<ol>
<li><p>容错性</p>
<p>假设Node C宕机，可以看到此时对象A、B、D不会受到影响。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据且这些数据会转移到D进行存储。</p>
</li>
</ol>
<p>​    <img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234910211.png" alt="image-20241216234910211">    </p>
<ol start="2">
<li><p>扩展性</p>
<p>数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，不会导致hash取余全部数据重新洗牌。</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216234958862.png" alt="image-20241216234958862">    </p>
</li>
</ol>
<p><strong>缺点：</strong>Hash环的数据倾斜问题</p>
<p>一致性Hash算法在服务<strong>节点太少时</strong>，容易因为节点分布不均匀而造成<strong>数据倾斜</strong>（被缓存的对象大部分集中缓存在某一台服务器上）问题，例如系统中只有两台服务器：</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235038722.png" alt="image-20241216235038722">    </p>
<h5 id="哈希槽分区"><a href="#哈希槽分区" class="headerlink" title="哈希槽分区"></a>哈希槽分区</h5><h6 id="为什么会出现"><a href="#为什么会出现" class="headerlink" title="为什么会出现"></a>为什么会出现</h6><p>为了解决一致性哈希算法的数据倾斜问题，哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p>
<h6 id="能干什么"><a href="#能干什么" class="headerlink" title="能干什么"></a>能干什么</h6><p>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235209600.png" alt="image-20241216235209600">    </p>
<p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配</p>
<h6 id="多少个-hash-槽"><a href="#多少个-hash-槽" class="headerlink" title="多少个 hash 槽"></a>多少个 hash 槽</h6><p>一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。</p>
<p>集群会记录节点和槽的对应关系，解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取模，余数是几key就落入对应的槽里。HASH_SLOT = CRC16(key) mod 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p>
<h6 id="哈希槽计算"><a href="#哈希槽计算" class="headerlink" title="哈希槽计算"></a>哈希槽计算</h6><p>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis先对key使用crc16算法算出一个结果然后用结果对16384求余数[ CRC16(key) % 16384]，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p>
<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241216235314898.png" alt="image-20241216235314898">    </p>
<h4 id="为什么-Redis-集群的最大槽数是-16384-个？"><a href="#为什么-Redis-集群的最大槽数是-16384-个？" class="headerlink" title="为什么 Redis 集群的最大槽数是 16384 个？"></a>为什么 Redis 集群的最大槽数是 16384 个？</h4><p>参考 redis 之父 antirez 所说：<a target="_blank" rel="noopener" href="https://github.com/redis/redis/issues/2576">https://github.com/redis/redis/issues/2576</a></p>
<p>正常的心跳数据包带有节点的完整配置，可以用幂等方式用旧的节点替换旧节点，以便更新旧的配置。</p>
<p>这意味着它们包含原始节点的插槽配置，该节点使用2k的空间和16k的插槽，但是会使用8k的空间（使用65k的插槽）。</p>
<p>同时，由于其他设计折衷，Redis集群不太可能扩展到1000个以上的主节点。</p>
<p>因此16k处于正确的范围内，以确保每个主机具有足够的插槽，最多可容纳1000个矩阵，但数量足够少，可以轻松地将插槽配置作为原始位图传播。请注意，在小型群集中，位图将难以压缩，因为当N较小时，位图将设置的slot / N位占设置位的很大百分比。</p>
<h3 id="Redis集群一致性保证"><a href="#Redis集群一致性保证" class="headerlink" title="Redis集群一致性保证"></a>Redis集群一致性保证</h3><p>Redis集群不保证<strong>强一致性</strong>。实际上，这意味着在某些情况下，Redis集群可能会丢失系统向客户端确认的写入。</p>
<p>Redis集群可能丢失写操作的第一个原因是它使用了异步复制。这意味着在写入期间会发生以下情况：</p>
<ul>
<li>您的客户机向主服务器B写入。</li>
<li>主机B向客户端回复OK。</li>
<li>主设备B将写入传播到其副本B1、B2和B3。</li>
</ul>
<p>正如你所看到的，B在回复客户端之前不会等待B1、B2、B3的确认，因为这对Redis来说是一个禁止的延迟惩罚，所以如果你的客户端写了一些东西，B确认了写操作，但是在能够将写操作发送到它的副本之前崩溃了，其中一个副本（没有接收到写操作）可能会被提升到主节点，永远失去写操作。</p>
<p>这与大多数配置为每秒将数据刷新到磁盘的数据库所发生的情况非常相似，因此，由于传统数据库系统不涉及分布式系统的过去经验，您已经能够推理出这种情况。类似地，您可以通过强制数据库在回复客户端之前将数据刷新到磁盘来提高一致性，但这通常会导致非常低的性能。这相当于Redis集群中的同步复制。</p>
<p>基本上，在性能和一致性之间需要进行权衡。</p>
<h3 id="Redis-集群配置"><a href="#Redis-集群配置" class="headerlink" title="Redis 集群配置"></a>Redis 集群配置</h3><ul>
<li>**cluster-enabled<code>&lt;yes/no&gt;</code>**：如果是，则在特定Redis实例中启用Redis集群支持。否则，实例将像往常一样作为独立实例启动。</li>
<li>**cluster-config-file<code>&lt;filename&gt;</code>**：请注意，尽管这个选项的名称，这不是一个用户可编辑的配置文件，但Redis集群节点在每次更改时都会自动保存集群配置（基本上是状态），以便能够在启动时重新读取它。该文件列出了集群中的其他节点、它们的状态、持久变量等内容。由于接收到某些消息，这个文件经常被重写并刷新到磁盘上。</li>
<li>**cluster-node-timeout<code>&lt;milliseconds&gt;</code>**：Redis集群节点不可用的最长时间，而不会被视为失败。如果一个主节点在超过指定的时间内不可达，它将被它的副本故障转移。这个参数控制着Redis集群中其他重要的东西。值得注意的是，在指定的时间内无法到达大多数主节点的每个节点将停止接受查询。</li>
<li>**cluster-slave-validity-factor<code>&lt;factor&gt;</code>*<em>：如果设置为零，副本将始终认为自己有效，因此将始终尝试对主服务器进行故障转移，而不管主服务器和副本之间的链路保持断开的时间。如果该值为正数，则最大断开时间计算为</em>节点超*时值乘以此选项提供的因子，如果节点是副本节点，则在主链路断开的时间超过指定时间时，它不会尝试启动故障转移。例如，如果节点超时设置为5秒，有效性因子设置为10，则与主服务器断开连接超过50秒的副本服务器将不会尝试对其主服务器进行故障切换。请注意，如果没有副本能够进行故障转移，任何不同于零的值都可能导致Redis集群在主服务器故障后不可用。 在这种情况下，只有当原始主服务器重新加入群集时，群集才会恢复可用状态。</li>
<li>**cluster-migration-barrier<code>&lt;count&gt;</code>**：主服务器将保持连接的副本的最小数量，以便另一个副本迁移到不再被任何副本覆盖的主服务器。</li>
<li>**cluster-require-full-coverage<code>&lt;yes/no&gt;</code>**：如果将此设置为yes（默认情况下），则如果某个百分比的键空间未被任何节点覆盖，群集将停止接受写入。如果该选项设置为no，则集群仍将服务查询，即使只能处理关于键子集的请求。</li>
<li>**cluster-allow-reads-when-down<code>&lt;yes/no&gt;</code>**：如果默认设置为no，Redis集群中的节点将在集群被标记为失败时停止为所有流量提供服务，无论是当节点无法达到主节点的法定数量还是当未达到完全覆盖时。这可以防止从不知道群集中更改的节点阅读可能不一致的数据。此选项可以设置为yes以允许在故障状态期间从节点读取，这对于希望优先考虑读取可用性但仍希望防止不一致写入的应用程序很有用。它也可以用于使用只有一个或两个分片的Redis集群时，因为它允许节点在主服务器失败但无法自动故障转移时继续提供写服务。</li>
</ul>
<h3 id="Redis-集群常用命令"><a href="#Redis-集群常用命令" class="headerlink" title="Redis 集群常用命令"></a>Redis 集群常用命令</h3><ul>
<li><p><code>redis-cli -a &lt;password&gt; -p &lt;port&gt; -c</code> -c: 防止路由失效</p>
</li>
<li><p><code>cluster nodes</code>: 查看集群信息</p>
</li>
<li><p><code>cluster keyslot &lt;key&gt;</code>: 查看某个 key 的 slot 槽位值</p>
</li>
<li><p><code>cluster info</code>: 查看集群信息</p>
</li>
<li><p><code>cluster failover</code>: 手动调整主从节点关系</p>
</li>
<li><p><code>redis-cli -a &lt;password&gt; --cluster check &lt;ip&gt;:port</code>：检查集群情况</p>
</li>
<li><p><code>redis-cli -a &lt;password&gt; --cluster create --cluster-replicas 1 [&lt;主ip1&gt;:&lt;port&gt; &lt;从ip1&gt;:&lt;port&gt; &lt;主ip2&gt;:&lt;port&gt; &lt;从ip2&gt;:&lt;port&gt; ......]</code> : 创建集群节点</p>
</li>
<li><p><code>redis-cli -a &lt;password&gt;--cluster add-node &lt;要添加的主ip&gt;:&lt;要添加的主port&gt; &lt;已经存在的主ip&gt;:&lt;已经存在的主port&gt;</code>：添加集群主节点</p>
</li>
<li><p><code>redis-cli -a &lt;password&gt;--cluster add-node &lt;要添加的从ip&gt;:&lt;要添加的从port&gt; &lt;已经存在的主ip&gt;:&lt;已经存在的主port&gt; --cluster-slave --cluster-master-id &lt;已经存在的主节点的id&gt;</code>:  往主节点从添加从节点</p>
</li>
<li><p><code>redis-cli -a &lt;password&gt; --cluster del-node &lt;要删除的集群ip&gt;:&lt;要删除的集群port&gt; &lt;集群id&gt;</code>: 删除集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@vm001 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.100:6381</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 5461 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 2 keys | 5461 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 5462 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 3 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.100:6381)</span></span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Redis-集群搭建"><a href="#Redis-集群搭建" class="headerlink" title="Redis 集群搭建"></a>Redis 集群搭建</h3><ol>
<li><p>前置条件：准备好三台服务器或者虚拟机，保证三台机器能网络能够互通</p>
<blockquote>
<p>注意：注意防护墙的限制，需要把 Redis 集群的端口开放，保证端口也能互通</p>
<p>例：如果机器1要开放 6381、6382 端口作为集群，那么 6381、6382、16381、16382 都需要开放端口出来</p>
</blockquote>
</li>
<li><p>新建 /myRedis/cluster 文件夹 <code>mkdir /myRedis/cluster</code></p>
</li>
<li><p>新建集群的配置文件，放入每台机器的 /myRedis/cluster 中，端口号、密码、地址等根据自己的来配置，例：redisCluster6381.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">port 6381</span><br><span class="line">logfile &quot;/myRedis/cluster/cluster6381.log&quot;</span><br><span class="line">pidfile /myRedis/cluster6381.pid</span><br><span class="line">dir /myRedis/cluster</span><br><span class="line">dbfilename dump6381.rdb</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly6381.aof&quot;</span><br><span class="line">requirepass Passw0rd</span><br><span class="line">masterauth Passw0rd</span><br><span class="line"> </span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6381.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="4">
<li><p>运行集群，切换到 /usr/local/bin 目录中，执行命令 <code>redis-server /myRedis/cluster/redisCluster6381.conf</code>，切换到不同机器依次执行，配置文件名称根据当前机器的来</p>
</li>
<li><p>运行成功后，查看一下 redis 实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@vm001 cluster]# ps -ef |grep redis</span><br><span class="line">root       7745      1  1 12月19 ?      00:10:50 redis-server 0.0.0.0:6382 [cluster]</span><br><span class="line">root      22363      1  1 12月19 ?      00:06:19 redis-server 0.0.0.0:6381 [cluster]</span><br></pre></td></tr></table></figure></li>
<li><p>再使用 redis-cli 连接其中一条集群，来构建集群关系</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-a auth 验证 -p 端口号 -c 防止路由失效</span></span><br><span class="line">redis-cli -a passw0rd -p 6381 -c</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建集群主从关系 6381为主机，6382为6381的从机，6383为主机，6384为6383的从机，6385为主机，6386为6385的从机</span></span><br><span class="line">redis-cli -a Passw0rd --cluster create --cluster-replicas 1 192.168.10.100:6381 192.168.10.100:6382 192.168.10.101:6383 192.168.10.101:6384 192.168.10.102:6385 192.168.10.102:6386</span><br></pre></td></tr></table></figure>

<p><img src="/../../image/Redis%E5%9F%BA%E7%A1%80.assets/image-20241220093104263.png" alt="image-20241220093104263">    </p>
<p>出现如下表示构建成功</p>
</li>
<li><p>查看集群信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; CLUSTER NODES</span><br><span class="line">5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384@16384 slave 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 0 1734658704000 11 connected</span><br><span class="line">5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381@16381 myself,master - 0 0 11 connected 0-5460</span><br><span class="line">01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382@16382 master - 0 1734658704682 8 connected 10923-16383</span><br><span class="line">b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383@16383 slave d9662ef992c5ba6421afca6d7da13739ceefc416 0 1734658703669 12 connected</span><br><span class="line">414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385@16385 slave 01972a5499fe6fb8ae04150ae1672ff3ec23d703 0 1734658703000 8 connected</span><br><span class="line">d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386@16386 master - 0 1734658704000 12 connected 5461-10922</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Redis-容错迁移"><a href="#Redis-容错迁移" class="headerlink" title="Redis 容错迁移"></a>Redis 容错迁移</h3><p>6381 主节点挂了之后的容错迁移</p>
<ol>
<li><p>redis-cli 连接 6381主节点，查看集群信息，6384 为 6381 的从节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; CLUSTER NODES</span><br><span class="line">5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384@16384 slave 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 0 1734658704000 11 connected</span><br><span class="line">5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381@16381 myself,master - 0 0 11 connected 0-5460</span><br><span class="line">01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382@16382 master - 0 1734658704682 8 connected 10923-16383</span><br><span class="line">b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383@16383 slave d9662ef992c5ba6421afca6d7da13739ceefc416 0 1734658703669 12 connected</span><br><span class="line">414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385@16385 slave 01972a5499fe6fb8ae04150ae1672ff3ec23d703 0 1734658703000 8 connected</span><br><span class="line">d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386@16386 master - 0 1734658704000 12 connected 5461-10922</span><br></pre></td></tr></table></figure></li>
<li><p>执行 <code>shutdown</code> 命令</p>
</li>
<li><p>再连接其他集群，查看集群节点信息，6384 自动上位变成 master 了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">192.168.10.100:6381@16381 master,fail 6381 挂了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">192.168.10.101:6384@16384 maste 6384 上位，变成 master 了</span></span><br><span class="line">127.0.0.1:6383&gt; CLUSTER NODES</span><br><span class="line">d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386@16386 slave b192fee36abc4f45194000e4a9ae7b57f268020f 0 1734660988329 16 connected</span><br><span class="line">b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383@16383 myself,master - 0 0 16 connected 5461-10922</span><br><span class="line">414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385@16385 master - 0 1734660987000 17 connected 10923-16383</span><br><span class="line">5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384@16384 master - 0 1734660987305 15 connected 0-5460</span><br><span class="line">5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381@16381 master,fail - 1734658843521 1734658841000 11 disconnected</span><br><span class="line">01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382@16382 slave 414b128d5bce7b3f326472c98f01377600c0f2c9 0 1734660988000 17 connected</span><br></pre></td></tr></table></figure></li>
<li><p>模拟 6381 节点恢复了，重新启动 6381 节点，查看集群情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 6381</span></span><br><span class="line">[root@vm001 bin]# redis-server /myRedis/cluster/redisCluster6381.conf </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接 6381</span></span><br><span class="line">[root@vm001 bin]# redis-cli -a Passw0rd -p 6381 -c</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群情况 6381 变成 6384 的 salve 了</span></span><br><span class="line">127.0.0.1:6381&gt; CLUSTER NODES</span><br><span class="line">414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385@16385 master - 0 1734661915534 17 connected 10923-16383</span><br><span class="line">5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384@16384 master - 0 1734661913910 15 connected 0-5460</span><br><span class="line">01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382@16382 slave 414b128d5bce7b3f326472c98f01377600c0f2c9 0 1734661914517 17 connected</span><br><span class="line">d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386@16386 slave b192fee36abc4f45194000e4a9ae7b57f268020f 0 1734661914000 16 connected</span><br><span class="line">5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381@16381 myself,slave 5fb01a70cec4991b956815788ee1a6bb48809018 0 0 15 connected</span><br><span class="line">b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383@16383 master - 0 1734661915432 16 connected 5461-10922</span><br></pre></td></tr></table></figure></li>
<li><p>如果想恢复原来的主从关系，6381 作为 6384 的主节点，在 6381 客户端上执行 <code>CLUSTER FAILOVER</code> 命令即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; CLUSTER FAILOVER</span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群情况，6381 恢复成主节点，6384 为 6381 的从节点</span></span><br><span class="line">127.0.0.1:6381&gt; CLUSTER NODES</span><br><span class="line">414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385@16385 master - 0 1734662101000 17 connected 10923-16383</span><br><span class="line">5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384@16384 slave 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 0 1734662100981 19 connected</span><br><span class="line">01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382@16382 slave 414b128d5bce7b3f326472c98f01377600c0f2c9 0 1734662103000 17 connected</span><br><span class="line">d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386@16386 slave b192fee36abc4f45194000e4a9ae7b57f268020f 0 1734662102000 16 connected</span><br><span class="line">5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381@16381 myself,master - 0 0 19 connected 0-5460</span><br><span class="line">b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383@16383 master - 0 1734662101991 16 connected 5461-10922</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Redis-集群扩容"><a href="#Redis-集群扩容" class="headerlink" title="Redis 集群扩容"></a>Redis 集群扩容</h3><p>新增 6387、6388 两个集群</p>
<ol>
<li><p>复制集群配置文件并修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制配置文件</span></span><br><span class="line">[root@vm003 cluster]# cp redisCluster6386.conf redisCluster6387.conf</span><br><span class="line">[root@vm003 cluster]# cp redisCluster6387.conf redisCluster6388.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改端口号等信息</span></span><br><span class="line">[root@vm003 cluster]# vim redisCluster6387.conf</span><br><span class="line">[root@vm003 cluster]# vim redisCluster6388.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看修改后的配置</span></span><br><span class="line">[root@vm003 cluster]# cat redisCluster6387.conf </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">port 6387</span><br><span class="line">logfile &quot;/myRedis/cluster/cluster6387.log&quot;</span><br><span class="line">pidfile /myRedis/cluster6387.pid</span><br><span class="line">dir /myRedis/cluster</span><br><span class="line">dbfilename dump6387.rdb</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly6387.aof&quot;</span><br><span class="line">requirepass Passw0rd</span><br><span class="line">masterauth Passw0rd</span><br><span class="line"> </span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6387.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>启动 6387 和 6388</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 cluster]# cd /usr/local/bin/、</span><br><span class="line">[root@vm003 bin]# redis-server /myRedis/cluster/redisCluster6387.conf </span><br><span class="line">[root@vm003 bin]# redis-server /myRedis/cluster/redisCluster6388.conf </span><br><span class="line">[root@vm003 bin]# ps -ef |grep redis</span><br><span class="line">root       1792      1  1 12月19 ?      00:13:10 redis-server 0.0.0.0:6385 [cluster]</span><br><span class="line">root       1799      1  1 12月19 ?      00:13:06 redis-server 0.0.0.0:6386 [cluster]</span><br><span class="line">root       2542      1  2 13:53 ?        00:00:00 redis-server 0.0.0.0:6387 [cluster]</span><br><span class="line">root       2549      1  2 13:53 ?        00:00:00 redis-server 0.0.0.0:6388 [cluster]</span><br><span class="line">root       2556   2509  0 13:53 pts/0    00:00:00 grep --color=auto redis</span><br></pre></td></tr></table></figure></li>
<li><p>将 6387 通过 6381 加入集群，并检查集群情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加入集群</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster add-node 192.168.10.102:6387 192.168.10.100:6381</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Adding node 192.168.10.102:6387 to cluster 192.168.10.100:6381</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.100:6381)</span></span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Getting <span class="built_in">functions</span> from cluster</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Send FUNCTION LIST to 192.168.10.102:6387 to verify there is no <span class="built_in">functions</span> <span class="keyword">in</span> it</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Send FUNCTION RESTORE to 192.168.10.102:6387</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Send CLUSTER MEET to node 192.168.10.102:6387 to make it <span class="built_in">join</span> the cluster.</span></span><br><span class="line">[OK] New node added correctly.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查集群情况 6387 没有槽位数</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 5462 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 2 keys | 5461 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6387 (60a66332...) -&gt; 0 keys | 0 slots | 0 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 5461 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots: (0 slots) master</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
<li><p>给 6387 重新分配槽位</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新分配槽位，输入要分配的槽位数量和 master-id</span> </span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster reshard 192.168.10.102:6387</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6387)</span></span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots: (0 slots) master</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">How many slots do you want to move (from 1 to 16384)? 4096</span><br><span class="line">What is the receiving node ID? 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">Please enter all the source node IDs.</span><br><span class="line">  Type &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.</span><br><span class="line">  Type &#x27;done&#x27; once you entered all the source nodes IDs.</span><br><span class="line">Source node #1: all</span><br><span class="line"></span><br><span class="line">Ready to move 4096 slots.</span><br><span class="line">  Source nodes:</span><br><span class="line">    M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">       slots:[10923-16383] (5461 slots) master</span><br><span class="line">       1 additional replica(s)</span><br><span class="line">    M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">       slots:[5461-10922] (5462 slots) master</span><br><span class="line">       1 additional replica(s)</span><br><span class="line">    M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">       slots:[0-5460] (5461 slots) master</span><br><span class="line">       1 additional replica(s)</span><br><span class="line">  Destination node:</span><br><span class="line">    M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">       slots: (0 slots) master</span><br><span class="line">  Resharding plan:</span><br><span class="line">......</span><br></pre></td></tr></table></figure></li>
<li><p>再次检查集群，查看集群情况，查看槽位分配情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6387 (60a66332...) -&gt; 1 keys | 4096 slots | 0 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
<li><p>给 6387 主机配从节点 6388</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster add-node 192.168.10.102:6388 192.168.10.102:6387 --cluster-slave --cluster-master-id 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Adding node 192.168.10.102:6388 to cluster 192.168.10.102:6387</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6387)</span></span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Send CLUSTER MEET to node 192.168.10.102:6388 to make it <span class="built_in">join</span> the cluster.</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Configure node as replica of 192.168.10.102:6387.</span></span><br><span class="line">[OK] New node added correctly.</span><br></pre></td></tr></table></figure></li>
<li><p>检查集群情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6387 (60a66332...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 7fec936efced4fe06e14410376c342809b4ca397 192.168.10.102:6388</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Redis-集群缩容"><a href="#Redis-集群缩容" class="headerlink" title="Redis 集群缩容"></a>Redis 集群缩容</h3><p>将 6387 和 6388 下线</p>
<ol>
<li><p>检查集群，从节点 6388 的 id</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6387 (60a66332...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 7fec936efced4fe06e14410376c342809b4ca397 192.168.10.102:6388</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
<li><p>先删除 6388 从节点，并检查集群情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除 6388</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster del-node 192.168.10.102:6388 7fec936efced4fe06e14410376c342809b4ca397</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Removing node 7fec936efced4fe06e14410376c342809b4ca397 from cluster 192.168.10.102:6388</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER FORGET messages to the cluster...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER RESET SOFT to the deleted node.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查集群，已经没有了6388</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6387 (60a66332...) -&gt; 1 keys | 4096 slots | 0 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
<li><p>清空 6387 主节点的槽位，返还给 6384 主节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster reshard 192.168.10.102:6387</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6387)</span></span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">How many slots do you want to move (from 1 to 16384)? 5096^H^H^C</span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster reshard 192.168.10.102:6387</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6387)</span></span><br><span class="line">M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">How many slots do you want to move (from 1 to 16384)? 4096</span><br><span class="line">What is the receiving node ID? 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">Please enter all the source node IDs.</span><br><span class="line">  Type &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.</span><br><span class="line">  Type &#x27;done&#x27; once you entered all the source nodes IDs.</span><br><span class="line">Source node #1: 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">Source node #2: done</span><br><span class="line"></span><br><span class="line">Ready to move 4096 slots.</span><br><span class="line">  Source nodes:</span><br><span class="line">    M: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">       slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">  Destination node:</span><br><span class="line">    M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">       slots:[1365-5460] (4096 slots) master</span><br><span class="line">       1 additional replica(s)</span><br><span class="line">  Resharding plan:</span><br><span class="line">......</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群情况，此时 6387 还没有被删除，6384 有 8192 个槽位和两个 slave</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 2 keys | 8192 slots | 2 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 3 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-6826],[10923-12287] (8192 slots) master</span><br><span class="line">   2 additional replica(s)</span><br><span class="line">S: 60a66332ddbab1da55110e8694aebb1b5323e4aa 192.168.10.102:6387</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure></li>
<li><p>删除 6387 主节点，再次检查集群查看情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster del-node 192.168.10.102:6387 60a66332ddbab1da55110e8694aebb1b5323e4aa</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Removing node 60a66332ddbab1da55110e8694aebb1b5323e4aa from cluster 192.168.10.102:6387</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER FORGET messages to the cluster...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER RESET SOFT to the deleted node.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群情况</span></span><br><span class="line">[root@vm003 bin]# redis-cli -a Passw0rd --cluster check 192.168.10.102:6386</span><br><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">192.168.10.102:6386 (d9662ef9...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.10.101:6384 (5fb01a70...) -&gt; 2 keys | 8192 slots | 1 slaves.</span><br><span class="line">192.168.10.102:6385 (414b128d...) -&gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 4 keys in 3 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.10.102:6386)</span></span><br><span class="line">M: d9662ef992c5ba6421afca6d7da13739ceefc416 192.168.10.102:6386</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5fb01a70cec4991b956815788ee1a6bb48809018 192.168.10.101:6384</span><br><span class="line">   slots:[0-6826],[10923-12287] (8192 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b192fee36abc4f45194000e4a9ae7b57f268020f 192.168.10.101:6383</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d9662ef992c5ba6421afca6d7da13739ceefc416</span><br><span class="line">M: 414b128d5bce7b3f326472c98f01377600c0f2c9 192.168.10.102:6385</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 5c762bc8e5810c6fa2bcb56d0b795d948997bd40 192.168.10.100:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5fb01a70cec4991b956815788ee1a6bb48809018</span><br><span class="line">S: 01972a5499fe6fb8ae04150ae1672ff3ec23d703 192.168.10.100:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 414b128d5bce7b3f326472c98f01377600c0f2c9</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="SpringBoot-集成-Redis"><a href="#SpringBoot-集成-Redis" class="headerlink" title="SpringBoot 集成 Redis"></a>SpringBoot 集成 Redis</h2><p>新建一个 SpringBoot 项目，基础 pom 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis7<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="jedis-集成"><a href="#jedis-集成" class="headerlink" title="jedis 集成"></a>jedis 集成</h3><p>引入 jedis 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JedisDemo.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：HuYukun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.100&quot;</span>, <span class="number">6379</span>)) &#123;</span><br><span class="line">            <span class="comment">// 密码认证</span></span><br><span class="line">            jedis.auth(<span class="string">&quot;Passw0rd&quot;</span>);</span><br><span class="line">            System.out.println(jedis.ping());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// string</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================string================&quot;</span>);</span><br><span class="line">            jedis.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// list</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================list================&quot;</span>);</span><br><span class="line">            jedis.lpush(<span class="string">&quot;l1&quot;</span>, <span class="string">&quot;lv1&quot;</span>, <span class="string">&quot;lv2&quot;</span>);</span><br><span class="line">            List&lt;String&gt; list = jedis.lrange(<span class="string">&quot;l1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// set</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================set================&quot;</span>);</span><br><span class="line">            jedis.sadd(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;sv1&quot;</span>, <span class="string">&quot;sv2&quot;</span>);</span><br><span class="line">            Set&lt;String&gt; sets = jedis.smembers(<span class="string">&quot;s1&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String set : sets) &#123;</span><br><span class="line">                System.out.println(set);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// zset</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================zset================&quot;</span>);</span><br><span class="line">            jedis.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">0d</span>, <span class="string">&quot;zv1&quot;</span>);</span><br><span class="line">            jedis.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">1d</span>, <span class="string">&quot;zv2&quot;</span>);</span><br><span class="line">            jedis.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">2d</span>, <span class="string">&quot;zv3&quot;</span>);</span><br><span class="line">            Set&lt;String&gt; zsets = jedis.zrange(<span class="string">&quot;z1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (String zset : zsets) &#123;</span><br><span class="line">                System.out.println(zset);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// hash</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================hash================&quot;</span>);</span><br><span class="line">            HashMap&lt;String, String&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            hashMap.put(<span class="string">&quot;f1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;f2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;f3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">            jedis.hset(<span class="string">&quot;h1&quot;</span>, hashMap);</span><br><span class="line">            List&lt;String&gt; hmgets = jedis.hmget(<span class="string">&quot;h1&quot;</span>, <span class="string">&quot;f1&quot;</span>, <span class="string">&quot;f2&quot;</span>, <span class="string">&quot;f3&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String hmget : hmgets) &#123;</span><br><span class="line">                System.out.println(hmget);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Lettuce-集成"><a href="#Lettuce-集成" class="headerlink" title="Lettuce 集成"></a>Lettuce 集成</h3><p>引入 lettuce 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>LettuceDemo.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.lettuce.core.KeyValue;</span><br><span class="line"><span class="keyword">import</span> io.lettuce.core.RedisClient;</span><br><span class="line"><span class="keyword">import</span> io.lettuce.core.RedisURI;</span><br><span class="line"><span class="keyword">import</span> io.lettuce.core.api.StatefulRedisConnection;</span><br><span class="line"><span class="keyword">import</span> io.lettuce.core.api.sync.RedisCommands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：HuYukun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LettuceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建连接</span></span><br><span class="line">        <span class="type">RedisURI</span> <span class="variable">uri</span> <span class="operator">=</span> RedisURI.builder().withHost(<span class="string">&quot;192.168.10.100&quot;</span>).withPort(<span class="number">6379</span>).withAuthentication(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;Passw0rd&quot;</span>).build();</span><br><span class="line">        <span class="type">RedisClient</span> <span class="variable">client</span> <span class="operator">=</span> RedisClient.create(uri);</span><br><span class="line">        <span class="keyword">try</span> (StatefulRedisConnection&lt;String, String&gt; connect = client.connect()) &#123;</span><br><span class="line"></span><br><span class="line">            RedisCommands&lt;String, String&gt; commands = connect.sync();</span><br><span class="line">            <span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> commands.ping();</span><br><span class="line">            System.out.println(ping);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// string</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================string================&quot;</span>);</span><br><span class="line">            commands.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">            System.out.println(commands.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// list</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================list================&quot;</span>);</span><br><span class="line">            commands.lpush(<span class="string">&quot;l1&quot;</span>, <span class="string">&quot;lv1&quot;</span>, <span class="string">&quot;lv2&quot;</span>);</span><br><span class="line">            List&lt;String&gt; list = commands.lrange(<span class="string">&quot;l1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// set</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================set================&quot;</span>);</span><br><span class="line">            commands.sadd(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;sv1&quot;</span>, <span class="string">&quot;sv2&quot;</span>);</span><br><span class="line">            Set&lt;String&gt; sets = commands.smembers(<span class="string">&quot;s1&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String set : sets) &#123;</span><br><span class="line">                System.out.println(set);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// zset</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================zset================&quot;</span>);</span><br><span class="line">            commands.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">0d</span>, <span class="string">&quot;zv1&quot;</span>);</span><br><span class="line">            commands.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">1d</span>, <span class="string">&quot;zv2&quot;</span>);</span><br><span class="line">            commands.zadd(<span class="string">&quot;z1&quot;</span>, <span class="number">2d</span>, <span class="string">&quot;zv3&quot;</span>);</span><br><span class="line">            List&lt;String&gt; zsets = commands.zrange(<span class="string">&quot;z1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (String zset : zsets) &#123;</span><br><span class="line">                System.out.println(zset);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// hash</span></span><br><span class="line">            System.out.println(<span class="string">&quot;================hash================&quot;</span>);</span><br><span class="line">            HashMap&lt;String, String&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            hashMap.put(<span class="string">&quot;f1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;f2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;f3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">            commands.hset(<span class="string">&quot;h1&quot;</span>, hashMap);</span><br><span class="line">            List&lt;KeyValue&lt;String, String&gt;&gt; hmgetList = commands.hmget(<span class="string">&quot;h1&quot;</span>, <span class="string">&quot;f1&quot;</span>, <span class="string">&quot;f2&quot;</span>, <span class="string">&quot;f3&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (KeyValue&lt;String, String&gt; keyValue : hmgetList) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;key=&quot;</span> + keyValue.getKey() + <span class="string">&quot;,value=&quot;</span> + keyValue.getValue());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;================keys *================&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String key : commands.keys(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">                System.out.println(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="RedisTemlate-集成"><a href="#RedisTemlate-集成" class="headerlink" title="RedisTemlate 集成"></a>RedisTemlate 集成</h3><h4 id="连接单机-Redis"><a href="#连接单机-Redis" class="headerlink" title="连接单机 Redis"></a>连接单机 Redis</h4><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis7<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">springfox.version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">springfox.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringBoot与Redis整合依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--swagger2--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springfox.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springfox.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis7_study</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br><span class="line">  <span class="attr">swagger2:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.100</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">Passw0rd</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">D:/mylogs/redis7_study.log</span></span><br></pre></td></tr></table></figure>

<p>SwaggerConfig.class    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package org.example.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line">import springfox.documentation.builders.PathSelectors;</span><br><span class="line">import springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line">import springfox.documentation.service.ApiInfo;</span><br><span class="line">import springfox.documentation.spi.DocumentationType;</span><br><span class="line">import springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line">import springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author HuYukun</span><br><span class="line"> * @auther zzyy</span><br><span class="line"> * @create 2022-11-17 17:44</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class SwaggerConfig</span><br><span class="line">&#123;</span><br><span class="line">    @Value(&quot;$&#123;spring.swagger2.enabled&#125;&quot;)</span><br><span class="line">    private Boolean enabled;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Docket createRestApi() &#123;</span><br><span class="line">        return new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .enable(enabled)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(&quot;org.example&quot;)) //你自己的package</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    public ApiInfo apiInfo() &#123;</span><br><span class="line">        return new ApiInfoBuilder()</span><br><span class="line">                .title(&quot;springboot利用swagger2构建api接口文档 &quot;+&quot;\t&quot;+ DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;).format(LocalDateTime.now()))</span><br><span class="line">                .description(&quot;springboot+redis整合,有问题给管理员阳哥邮件:zzyybs@126.com&quot;)</span><br><span class="line">                .version(&quot;1.0&quot;)</span><br><span class="line">                .termsOfServiceUrl(&quot;https://www.atguigu.com/&quot;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedisConfig.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> zzyy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-11-17 17:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis序列化的工具配置类，下面这个请一定开启配置</span></span><br><span class="line"><span class="comment">     * 127.0.0.1:6379&gt; keys *</span></span><br><span class="line"><span class="comment">     * 1) &quot;ord:102&quot;  序列化过</span></span><br><span class="line"><span class="comment">     * 2) &quot;\xac\xed\x00\x05t\x00\aord:102&quot;   野生，没有序列化过</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForValue(); //提供了操作string类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForList(); // 提供了操作list类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForSet(); //提供了操作set的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForHash(); //提供了操作hash表的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForZSet(); //提供了操作zset的所有方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lettuceConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line">        <span class="comment">//设置key序列化方式string</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">//设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>OrderController.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.example.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：HuYukun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单API&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        orderService.addOrder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.getOrderById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>OrderService.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadLocalRandom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：HuYukun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;order:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">//    private StringRedisTemplate stringRedisTemplate;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">keyId</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">1000</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        redisTemplate.opsForValue().set(ORDER_KEY + keyId, <span class="string">&quot;京东订单&quot;</span> + orderNo);</span><br><span class="line"><span class="comment">//        stringRedisTemplate.opsForValue().set(ORDER_KEY + keyId, &quot;京东订单&quot; + orderNo);</span></span><br><span class="line">        log.info(<span class="string">&quot;=====编号&quot;</span> + keyId + <span class="string">&quot;的订单流水生成：&#123;&#125;&quot;</span>, orderNo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (String) redisTemplate.opsForValue().get(ORDER_KEY + id);</span><br><span class="line"><span class="comment">//        return stringRedisTemplate.opsForValue().get(ORDER_KEY + id);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="连接集成-Redis"><a href="#连接集成-Redis" class="headerlink" title="连接集成 Redis"></a>连接集成 Redis</h4><p>配置有所不同</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis7_study</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br><span class="line">  <span class="attr">swagger2:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  <span class="comment"># 单机连接</span></span><br><span class="line"><span class="comment">#    database: 0</span></span><br><span class="line"><span class="comment">#    host: 192.168.10.100</span></span><br><span class="line"><span class="comment">#    port: 6379</span></span><br><span class="line"><span class="comment">#    password: Passw0rd</span></span><br><span class="line">    <span class="comment"># 集群连接配置</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">Passw0rd</span></span><br><span class="line">    <span class="attr">cluster:</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.100</span><span class="string">:6381,192.168.10.100:6382,192.168.10.101:6383,192.168.10.101:6384,192.168.10.102:6385,192.168.10.102:6386</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">cluster:</span></span><br><span class="line">        <span class="attr">refresh:</span></span><br><span class="line">          <span class="comment">#支持集群拓扑动态感应刷新,自适应拓扑刷新是否使用所有可用的更新，默认false关闭</span></span><br><span class="line">          <span class="attr">adaptive:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment"># 定时刷新，</span></span><br><span class="line">          <span class="attr">period:</span> <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">D:/mylogs/redis7_study.log</span></span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>redis 官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p>教程：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13R4y1v7sP">https://www.bilibili.com/video/BV13R4y1v7sP</a>    </p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://example.com/2024/12/22/redis/Redis%E5%9F%BA%E7%A1%80/" title="Redis 基础" target="_blank" rel="external">http://example.com/2024/12/22/redis/Redis基础/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/2024/11/12/MySQL/mysql-%E9%9D%A2%E8%AF%95%E9%A2%98/" title="MySQL 面试题"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/klay11K/klay11K.github.io" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   






</body>
</html>